!function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/search/searchcursor",["../../lib/codemirror"],b):b(CodeMirror)}(function(b){function x(f,a){var c;c=f.flags;for(var g=c=null!=c?c:(f.ignoreCase?"i":"")+(f.global?"g":"")+(f.multiline?"m":""),e=0;e<a.length;e++)-1==g.indexOf(a.charAt(e))&&(g+=a.charAt(e));return c==g?f:new RegExp(f.source,g)}function z(f,a,c){a=x(a,"g");var g=c.line,e=c.ch;for(c=f.lastLine();g<=
c;g++,e=0)if(a.lastIndex=e,e=f.getLine(g),e=a.exec(e))return{from:l(g,e.index),to:l(g,e.index+e[0].length),match:e}}function h(f,a,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return z(f,a,c);a=x(a,"gm");for(var g,e=1,b=c.line,d=f.lastLine();b<=d;){for(var k=0;k<e&&!(b>d);k++){var t=f.getLine(b++);g=null==g?t:g+"\n"+t}e*=2;a.lastIndex=c.ch;if(k=a.exec(g))return a=g.slice(0,k.index).split("\n"),f=k[0].split("\n"),c=c.line+a.length-1,a=a[a.length-1].length,{from:l(c,a),to:l(c+f.length-1,1==f.length?
a+f[0].length:f[f.length-1].length),match:k}}}function m(f,a){for(var c,g=0;;){a.lastIndex=g;var e=a.exec(f);if(!e||(c=e,(g=c.index+(c[0].length||1))==f.length))return c}}function d(f,a,c){a=x(a,"g");var g=c.line,e=c.ch;for(c=f.firstLine();g>=c;g--,e=-1){var b=f.getLine(g);-1<e&&(b=b.slice(0,e));if(e=m(b,a))return{from:l(g,e.index),to:l(g,e.index+e[0].length),match:e}}}function q(f,a,c){a=x(a,"gm");for(var g,b=1,d=c.line,n=f.firstLine();d>=n;){for(var k=0;k<b;k++){var t=f.getLine(d--);g=null==g?t.slice(0,
c.ch):t+"\n"+g}b*=2;if(k=m(g,a))return a=g.slice(0,k.index).split("\n"),f=k[0].split("\n"),d+=a.length,a=a[a.length-1].length,{from:l(d,a),to:l(d+f.length-1,1==f.length?a+f[0].length:f[f.length-1].length),match:k}}}function n(f,a,c,b){if(f.length==a.length)return c;var e=0;for(a=c+Math.max(0,f.length-a.length);;){if(e==a)return e;var d=e+a>>1,l=b(f.slice(0,d)).length;if(l==c)return d;l>c?a=d:e=d+1}}function r(f,a,c,b){if(!a.length)return null;b=b?p:y;a=b(a).split(/\r|\n\r?/);var e=c.line;c=c.ch;var d=
f.lastLine()+1-a.length;a:for(;e<=d;e++,c=0){var h=f.getLine(e).slice(c),k=b(h);if(1==a.length){var t=k.indexOf(a[0]);if(-1==t)continue a;n(h,k,t,b);return{from:l(e,n(h,k,t,b)+c),to:l(e,n(h,k,t+a[0].length,b)+c)}}t=k.length-a[0].length;if(k.slice(t)==a[0]){for(var u=1;u<a.length-1;u++)if(b(f.getLine(e+u))!=a[u])continue a;var u=f.getLine(e+a.length-1),C=b(u),A=a[a.length-1];if(C.slice(0,A.length)==A)return{from:l(e,n(h,k,t,b)+c),to:l(e+a.length-1,n(u,C,A.length,b))}}}}function v(b,a,c,d){if(!a.length)return null;
d=d?p:y;a=d(a).split(/\r|\n\r?/);var e=c.line,h=c.ch,q=b.firstLine()-1+a.length;a:for(;e>=q;e--,h=-1){var k=b.getLine(e);-1<h&&(k=k.slice(0,h));h=d(k);if(1==a.length){c=h.lastIndexOf(a[0]);if(-1==c)continue a;return{from:l(e,n(k,h,c,d)),to:l(e,n(k,h,c+a[0].length,d))}}var t=a[a.length-1];if(h.slice(0,t.length)==t){var u=1;for(c=e-a.length+1;u<a.length-1;u++)if(d(b.getLine(c+u))!=a[u])continue a;c=b.getLine(e+1-a.length);u=d(c);if(u.slice(u.length-a[0].length)==a[0])return{from:l(e+1-a.length,n(c,
u,c.length-a[0].length,d)),to:l(e,n(k,h,t.length,d))}}}}function w(b,a,c,g){this.atOccurrence=!1;this.doc=b;c=c?b.clipPos(c):l(0,0);this.pos={from:c,to:c};var e;"object"==typeof g?e=g.caseFold:(e=g,g=null);"string"==typeof a?(null==e&&(e=!1),this.matches=function(c,d){return(c?v:r)(b,a,d,e)}):(a=x(a,"gm"),g&&!1===g.multiline?this.matches=function(c,e){return(c?d:z)(b,a,e)}:this.matches=function(c,d){return(c?q:h)(b,a,d)})}var p,y,l=b.Pos;String.prototype.normalize?(p=function(b){return b.normalize("NFD").toLowerCase()},
y=function(b){return b.normalize("NFD")}):(p=function(b){return b.toLowerCase()},y=function(b){return b});w.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(d){for(var a=this.matches(d,this.doc.clipPos(d?this.pos.from:this.pos.to));a&&0==b.cmpPos(a.from,a.to);)d?a.from.ch?a.from=l(a.from.line,a.from.ch-1):a=a.from.line==this.doc.firstLine()?null:this.matches(d,this.doc.clipPos(l(a.from.line-1))):a.to.ch<this.doc.getLine(a.to.line).length?
a.to=l(a.to.line,a.to.ch+1):a=a.to.line==this.doc.lastLine()?null:this.matches(d,l(a.to.line+1,0));if(a)return this.pos=a,this.atOccurrence=!0,this.pos.match||!0;d=l(d?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:d,to:d},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(d,a){if(this.atOccurrence){var c=b.splitLines(d);this.doc.replaceRange(c,this.pos.from,this.pos.to,a);this.pos.to=
l(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};b.defineExtension("getSearchCursor",function(b,a,c){return new w(this.doc,b,a,c)});b.defineDocExtension("getSearchCursor",function(b,a,c){return new w(this,b,a,c)});b.defineExtension("selectMatches",function(d,a){for(var c=[],g=this.getSearchCursor(d,this.getCursor("from"),a);g.findNext()&&!(0<b.cmpPos(g.to(),this.getCursor("to")));)c.push({anchor:g.from(),head:g.to()});c.length&&this.setSelections(c,0)})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/dialog/dialog",["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function x(h,m,d){var q;h=h.getWrapperElement();return q=h.appendChild(document.createElement("div")),q.className=d?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof m?q.innerHTML=m:q.appendChild(m),b.addClass(h,"dialog-opened"),
q}function z(b,m){b.state.currentNotificationClose&&b.state.currentNotificationClose();b.state.currentNotificationClose=m}b.defineExtension("openDialog",function(h,m,d){function q(h){"string"==typeof h?p.value=h:v||(v=!0,b.rmClass(r.parentNode,"dialog-opened"),r.parentNode.removeChild(r),w.focus(),d.onClose&&d.onClose(r))}d||(d={});z(this,null);var n,r=x(this,h,d.bottom),v=!1,w=this,p=r.getElementsByTagName("input")[0];return p?(p.focus(),d.value&&(p.value=d.value,!1!==d.selectValueOnOpen&&p.select()),
d.onInput&&b.on(p,"input",function(b){d.onInput(b,p.value,q)}),d.onKeyUp&&b.on(p,"keyup",function(b){d.onKeyUp(b,p.value,q)}),b.on(p,"keydown",function(h){d&&d.onKeyDown&&d.onKeyDown(h,p.value,q)||((27==h.keyCode||!1!==d.closeOnEnter&&13==h.keyCode)&&(p.blur(),b.e_stop(h),q()),13==h.keyCode&&m(p.value,h))}),!1!==d.closeOnBlur&&b.on(p,"blur",q)):(n=r.getElementsByTagName("button")[0])&&(b.on(n,"click",function(){q();w.focus()}),!1!==d.closeOnBlur&&b.on(n,"blur",q),n.focus()),q});b.defineExtension("openConfirm",
function(h,m,d){function q(){r||(r=!0,b.rmClass(n.parentNode,"dialog-opened"),n.parentNode.removeChild(n),v.focus())}z(this,null);var n=x(this,h,d&&d.bottom);h=n.getElementsByTagName("button");var r=!1,v=this,w=1;h[0].focus();for(d=0;d<h.length;++d){var p=h[d];!function(d){b.on(p,"click",function(h){b.e_preventDefault(h);q();d&&d(v)})}(m[d]);b.on(p,"blur",function(){--w;setTimeout(function(){0>=w&&q()},200)});b.on(p,"focus",function(){++w})}});b.defineExtension("openNotification",function(h,m){function d(){r||
(r=!0,clearTimeout(q),b.rmClass(n.parentNode,"dialog-opened"),n.parentNode.removeChild(n))}z(this,d);var q,n=x(this,h,m&&m.bottom),r=!1,v=m&&void 0!==m.duration?m.duration:5E3;return b.on(n,"click",function(h){b.e_preventDefault(h);d()}),v&&(q=setTimeout(d,v)),d})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("addon/search/search.js",["../../lib/codemirror","./searchcursor","../dialog/dialog"],b):b(CodeMirror)})(function(b){function x(k,a){return"string"==typeof k?k=new RegExp(k.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):k.global||(k=new RegExp(k.source,k.ignoreCase?"gi":"g")),{token:function(a){k.lastIndex=
a.pos;var b=k.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function z(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function h(k){return k.state.search||(k.state.search=new z)}function m(k){return"string"==typeof k&&k==k.toLowerCase()}function d(k,a,b){return k.getSearchCursor(a,b,{caseFold:m(a),multiline:!0})}function q(k,a,b,d,c){k.openDialog(a,d,{value:b,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){f(k)},
onKeyDown:c})}function n(k,a,b,d,c){k.openDialog?k.openDialog(a,c,{value:d,selectValueOnOpen:!0}):c(prompt(b,d))}function r(k,a,b,d){k.openConfirm?k.openConfirm(a,d):confirm(b)&&d[0]()}function v(k){return k.replace(/\\(.)/g,function(k,a){return"n"==a?"\n":"r"==a?"\r":a})}function w(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);if(b)try{a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(d){}else a=v(a);return("string"==typeof a?""==a:a.test(""))&&(a=/x^/),a}function p(a,b,d){b.queryText=d;b.query=w(d);
a.removeOverlay(b.overlay,m(b.query));b.overlay=x(b.query,m(b.query));a.addOverlay(b.overlay);a.showMatchesOnScrollbar&&(b.annotate&&(b.annotate.clear(),b.annotate=null),b.annotate=a.showMatchesOnScrollbar(b.query,m(b.query)))}function y(a,d,c,e){var f=h(a);if(f.query)return l(a,d);var m=a.getSelection()||f.lastQuery;if(m instanceof RegExp&&"x^"==m.source&&(m=null),c&&a.openDialog){var B=null,r=function(d,c){b.e_stop(c);d&&(d!=f.queryText&&(p(a,f,d),f.posFrom=f.posTo=a.getCursor()),B&&(B.style.opacity=
1),l(a,c.shiftKey,function(b,d){var c;3>d.line&&document.querySelector&&(c=a.display.wrapper.querySelector(".CodeMirror-dialog"))&&c.getBoundingClientRect().bottom-4>a.cursorCoords(d,"window").top&&((B=c).style.opacity=.4)}))};q(a,g,m,r,function(d,c){var e=b.keyName(d),f=a.getOption("extraKeys"),e=f&&f[e]||b.keyMap[a.getOption("keyMap")][e];"findNext"==e||"findPrev"==e||"findPersistentNext"==e||"findPersistentPrev"==e?(b.e_stop(d),p(a,h(a),c),a.execCommand(e)):"find"!=e&&"findPersistent"!=e||(b.e_stop(d),
r(c,d))});e&&m&&(p(a,f,m),l(a,d))}else n(a,g,"Search for:",m,function(b){b&&!f.query&&a.operation(function(){p(a,f,b);f.posFrom=f.posTo=a.getCursor();l(a,d)})})}function l(a,c,e){a.operation(function(){var f=h(a),g=d(a,f.query,c?f.posFrom:f.posTo);(g.find(c)||(g=d(a,f.query,c?b.Pos(a.lastLine()):b.Pos(a.firstLine(),0)),g.find(c)))&&(a.setSelection(g.from(),g.to()),a.scrollIntoView({from:g.from(),to:g.to()},20),f.posFrom=g.from(),f.posTo=g.to(),e&&e(g.from(),g.to()))})}function f(a){a.operation(function(){var b=
h(a);(b.lastQuery=b.query)&&(b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function a(a,b,c){a.operation(function(){for(var e=d(a,b);e.findNext();)if("string"!=typeof b){var f=a.getRange(e.from(),e.to()).match(b);e.replace(c.replace(/\$(\d)/g,function(a,b){return f[b]}))}else e.replace(c)})}function c(b,c){if(!b.getOption("readOnly")){var g=b.getSelection()||h(b).lastQuery,l='\x3cspan class\x3d"CodeMirror-search-label"\x3e'+(c?"Replace all:":
"Replace:")+"\x3c/span\x3e";n(b,l+e,l,g,function(e){e&&(e=w(e),n(b,D,"Replace with:","",function(g){if(g=v(g),c)a(b,e,g);else{f(b);var h=d(b,e,b.getCursor("from")),l=function(){var c,f=h.from();!(c=h.findNext())&&(h=d(b,e),!(c=h.findNext())||f&&h.from().line==f.line&&h.from().ch==f.ch)||(b.setSelection(h.from(),h.to()),b.scrollIntoView({from:h.from(),to:h.to()}),r(b,E,"Replace?",[function(){m(c)},l,function(){a(b,e,g)}]))},m=function(a){h.replace("string"==typeof e?g:g.replace(/\$(\d)/g,function(b,
c){return a[c]}));l()};l()}}))})}}var g='\x3cspan class\x3d"CodeMirror-search-label"\x3eSearch:\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',e=' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',
D='\x3cspan class\x3d"CodeMirror-search-label"\x3eWith:\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',E='\x3cspan class\x3d"CodeMirror-search-label"\x3eReplace?\x3c/span\x3e \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eAll\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e';b.commands.find=function(a){f(a);y(a)};b.commands.findPersistent=function(a){f(a);y(a,!1,!0)};b.commands.findPersistentNext=function(a){y(a,
!1,!0,!0)};b.commands.findPersistentPrev=function(a){y(a,!0,!0,!0)};b.commands.findNext=y;b.commands.findPrev=function(a){y(a,!0)};b.commands.clearSearch=f;b.commands.replace=c;b.commands.replaceAll=function(a){c(a,!0)}});(function(b){"function"==typeof b.define&&b.define("addonSearch",["addon/search/search.js"],function(){})})(this);
