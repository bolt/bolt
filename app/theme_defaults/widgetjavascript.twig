{% spaceless %}
<script>
/*<![CDATA[*/

    $(function() {
        $('div.widget').each(function () {
            if (typeof $(this).data('defer') === 'undefined') {
                return;
            }

            var key = $(this).data('key');

            $.ajax({
                url: '{{ paths.async }}widget/' + key,
                type: 'GET',
                success: function (result) {
                    $('#widget-' + key).html(result);
                },
                error: function () {
                    console.log('failed to get widget');
                }
            });
        });
    });

/*]]>*/
</script>
{% endspaceless %}