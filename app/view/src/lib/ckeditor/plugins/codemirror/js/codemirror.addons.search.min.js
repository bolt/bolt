(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],c):c(CodeMirror)})(function(c){function l(c,b,a){var e;return e=c.getWrapperElement().appendChild(document.createElement("div")),e.className=a?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof b?e.innerHTML=b:e.appendChild(b),e}function o(c,b){c.state.currentNotificationClose&&c.state.currentNotificationClose();
c.state.currentNotificationClose=b}c.defineExtension("openDialog",function(f,b,a){function e(b){if("string"==typeof b)d.value=b;else if(!h&&(h=!0,i.parentNode.removeChild(i),k.focus(),a.onClose))a.onClose(i)}var d;a||(a={});o(this,null);var i=l(this,f,a.bottom),h=!1,k=this;if(d=i.getElementsByTagName("input")[0],d){if(a.value&&(d.value=a.value,d.select()),a.onInput)c.on(d,"input",function(b){a.onInput(b,d.value,e)});if(a.onKeyUp)c.on(d,"keyup",function(b){a.onKeyUp(b,d.value,e)});c.on(d,"keydown",
function(f){a&&a.onKeyDown&&a.onKeyDown(f,d.value,e)||((27==f.keyCode||!1!==a.closeOnEnter&&13==f.keyCode)&&(d.blur(),c.e_stop(f),e()),13==f.keyCode&&b(d.value))});if(!1!==a.closeOnBlur)c.on(d,"blur",e);d.focus()}else if(f=i.getElementsByTagName("button")[0]){c.on(f,"click",function(){e();k.focus()});if(!1!==a.closeOnBlur)c.on(f,"blur",e);f.focus()}return e});c.defineExtension("openConfirm",function(f,b,a){function e(){h||(h=!0,i.parentNode.removeChild(i),k.focus())}var d;o(this,null);var i=l(this,
f,a&&a.bottom),a=i.getElementsByTagName("button"),h=!1,k=this,m=1;a[0].focus();for(f=0;f<a.length;++f)d=a[f],function(a){c.on(d,"click",function(b){c.e_preventDefault(b);e();a&&a(k)})}(b[f]),c.on(d,"blur",function(){--m;setTimeout(function(){0>=m&&e()},200)}),c.on(d,"focus",function(){++m})});c.defineExtension("openNotification",function(f,b){function a(){d||(d=!0,clearTimeout(i),e.parentNode.removeChild(e))}o(this,a);var e=l(this,f,b&&b.bottom),d=!1,i,h=b&&"undefined"!=typeof b.duration?b.duration:
5E3;c.on(e,"click",function(b){c.e_preventDefault(b);a()});return h&&(i=setTimeout(a,h)),a})});
(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],c):c(CodeMirror)})(function(c){function l(j,a){return"string"==typeof j?j=RegExp(j.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),a?"gi":"g"):j.global||(j=RegExp(j.source,j.ignoreCase?"gi":"g")),{token:function(a){j.lastIndex=a.pos;var b=
j.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length,"searching";b?a.pos=b.index:a.skipToEnd()}}}function o(){this.overlay=this.posFrom=this.posTo=this.query=null}function f(j){return j.state.search||(j.state.search=new o)}function b(j){return"string"==typeof j&&j==j.toLowerCase()}function a(j,a,c){return j.getSearchCursor(a,c,b(a))}function e(j,a,b,c,d){j.openDialog?j.openDialog(a,d,{value:c}):d(prompt(b,c))}function d(j,a,b,c){j.openConfirm?j.openConfirm(a,c):confirm(b)&&c[0]()}function i(a){var b=
a.match(/^\/(.*)\/([a-z]*)$/);return b?(a=RegExp(b[1],-1==b[2].indexOf("i")?"":"i"),a.test("")&&(a=/x^/)):""==a&&(a=/x^/),a}function h(a,c){var d=f(a);if(d.query)return k(a,c);e(a,n,"Search for:",a.getSelection(),function(e){a.operation(function(){e&&!d.query&&(d.query=i(e),a.removeOverlay(d.overlay,b(d.query)),d.overlay=l(d.query,b(d.query)),a.addOverlay(d.overlay),d.posFrom=d.posTo=a.getCursor(),k(a,c))})})}function k(b,d){b.operation(function(){var e=f(b),g=a(b,e.query,d?e.posFrom:e.posTo);(g.find(d)||
(g=a(b,e.query,d?c.Pos(b.lastLine()):c.Pos(b.firstLine(),0)),g.find(d)))&&(b.setSelection(g.from(),g.to()),b.scrollIntoView({from:g.from(),to:g.to()}),e.posFrom=g.from(),e.posTo=g.to())})}function m(a){a.operation(function(){var b=f(a);b.query&&(b.query=null,a.removeOverlay(b.overlay))})}function q(b,c){b.getOption("readOnly")||e(b,r,"Replace:",b.getSelection(),function(f){f&&(f=i(f),e(b,p,"Replace with:","",function(e){if(c)b.operation(function(){for(var d,c=a(b,f);c.findNext();)"string"!=typeof f?
(d=b.getRange(c.from(),c.to()).match(f),c.replace(e.replace(/\$(\d)/g,function(a,b){return d[b]}))):c.replace(e)});else{m(b);var n=a(b,f,b.getCursor()),h=function(){var c=n.from(),e;((e=n.findNext())||(n=a(b,f),(e=n.findNext())&&(!c||n.from().line!=c.line||n.from().ch!=c.ch)))&&(b.setSelection(n.from(),n.to()),b.scrollIntoView({from:n.from(),to:n.to()}),d(b,g,"Replace?",[function(){p(e)},h]))},p=function(a){n.replace("string"==typeof f?e:e.replace(/\$(\d)/g,function(b,c){return a[c]}));h()};h()}}))})}
var n='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',r='Replace: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',p='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',g="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";
c.commands.find=function(a){m(a);h(a)};c.commands.findNext=h;c.commands.findPrev=function(a){h(a,!0)};c.commands.clearSearch=m;c.commands.replace=q;c.commands.replaceAll=function(a){q(a,!0)}});
(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],c):c(CodeMirror)})(function(c){function l(b,a,c,d){var i,h,k,m;this.atOccurrence=!1;this.doc=b;null==d&&"string"==typeof a&&(d=!1);c=c?b.clipPos(c):f(0,0);this.pos={from:c,to:c};"string"!=typeof a?(a.global||(a=RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(c,d){var e,h,g,j,i;if(c){a.lastIndex=0;e=b.getLine(d.line).slice(0,
d.ch);for(h=0;!(a.lastIndex=h,i=a.exec(e),!i)&&!(g=i,j=g.index,h=g.index+(g[0].length||1),h==e.length););(h=g&&g[0].length||0)||(0==j&&0==e.length?g=void 0:j!=b.getLine(d.line).length&&h++)}else a.lastIndex=d.ch,e=b.getLine(d.line),h=(g=a.exec(e))&&g[0].length||0,j=g&&g.index,j+h==e.length||h||(h=1);if(g&&h)return{from:f(d.line,j),to:f(d.line,j+h),match:g}}):(i=a,d&&(a=a.toLowerCase()),h=d?function(a){return a.toLowerCase()}:function(a){return a},k=a.split("\n"),1==k.length?this.matches=a.length?
function(c,d){if(c){var e=b.getLine(d.line).slice(0,d.ch),k=h(e),g=k.lastIndexOf(a);if(-1<g)return g=o(e,k,g),{from:f(d.line,g),to:f(d.line,g+i.length)}}else if(e=b.getLine(d.line).slice(d.ch),k=h(e),g=k.indexOf(a),-1<g)return g=o(e,k,g)+d.ch,{from:f(d.line,g),to:f(d.line,g+i.length)}}:function(){}:(m=i.split("\n"),this.matches=function(a,d){var c=k.length-1,e,g,j,i,l;if(a){if(d.line-(k.length-1)<b.firstLine()||h(b.getLine(d.line).slice(0,m[c].length))!=k[k.length-1])return;e=f(d.line,m[c].length);
i=d.line-1;for(l=c-1;1<=l;--l,--i)if(k[l]!=h(b.getLine(i)))return;return(g=b.getLine(i),j=g.length-m[0].length,h(g.slice(j))!=k[0])?void 0:{from:f(i,j),to:e}}if(!(d.line+(k.length-1)>b.lastLine())&&(g=b.getLine(d.line),j=g.length-m[0].length,h(g.slice(j))==k[0])){e=f(d.line,j);i=d.line+1;for(l=1;l<c;++l,++i)if(k[l]!=h(b.getLine(i)))return;if(h(b.getLine(i).slice(0,m[c].length))==k[c])return{from:e,to:f(i,m[c].length)}}}))}function o(b,a,c){var d;if(b.length==a.length)return c;for(a=Math.min(c,b.length);;)if(d=
b.slice(0,a).toLowerCase().length,d<c)++a;else if(d>c)--a;else return a}var f=c.Pos;l.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(b){function a(a){a=f(a,0);return c.pos={from:a,to:a},c.atOccurrence=!1,!1}for(var c=this,d=this.doc.clipPos(b?this.pos.from:this.pos.to),i;;){if(this.pos=this.matches(b,d))return this.atOccurrence=!0,this.pos.match||!0;if(b){if(!d.line)return a(0);d=f(d.line-1,this.doc.getLine(d.line-1).length)}else{if(i=
this.doc.lineCount(),d.line==i-1)return a(i);d=f(d.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b){this.atOccurrence&&(b=c.splitLines(b),this.doc.replaceRange(b,this.pos.from,this.pos.to),this.pos.to=f(this.pos.from.line+b.length-1,b[b.length-1].length+(1==b.length?this.pos.from.ch:0)))}};c.defineExtension("getSearchCursor",function(b,a,c){return new l(this.doc,b,a,c)});c.defineDocExtension("getSearchCursor",
function(b,a,c){return new l(this,b,a,c)});c.defineExtension("selectMatches",function(b,a){for(var e=[],d=this.getSearchCursor(b,this.getCursor("from"),a);d.findNext()&&!(0<c.cmpPos(d.to(),this.getCursor("to")));)e.push({anchor:d.from(),head:d.to()});e.length&&this.setSelections(e,0)})});
