{% import '_macro.twig' as macro %}

{% for key, field in contenttype.fields %}

<div class="form-group">

{# --------------- prefix --------------- #}
{% if field.prefix is defined and field.prefix is not empty %}
<div class='clearfix'>
    {{ field.prefix|raw }}
</div>
{% endif %}


{# --------------- text --------------- #}

{% if field.type == "text" %}
    {% include 'editfields/_text.twig' %}
{% elseif field.type in ["float", "integer", "number"] %}
    {% include 'editfields/_float-integer.twig' %}
{% elseif field.type  == "checkbox" %}
    {% include 'editfields/_checkbox.twig' %}
{% elseif field.type == "slug" %}
    {% include 'editfields/_slug.twig' %}
{% endif %}

{# --------------- select --------------- #}

{% if field.type == "select" %}

    {% if field.values is iterable %}
        {% set values = field.values %}
    {% else %}
        {% set lookuptype = field.values|split('/')|first %}
        {% set lookupfield = field.values|split('/')|last %}
        {% if ',' in lookupfield %}
            {% set lookupfield = lookupfield|split(',') %}
        {% endif %}
        {% setcontent lookups = lookuptype order lookupfield|last %}
        {% set values = lookups|selectfield(lookupfield) %}
    {% endif %}

    {{ macro.label(key, field, 'col-sm-3 control-label') }}
    <div class="col-sm-9">
    {% if field.multiple is defined and field.multiple %}
        <select name="{{key}}[]" id="{{key}}" class='{% if field.class is defined %}{{ field.class }}{% endif %}' multiple>
            {% for value in values %}
                {% if value is iterable and (value | length) > 1 %}
                    <option value="{{value[0]}}" {% if value[0] in content.get(key) %}selected{% endif %}>{{value[1:]|join(' / ')}}</option>
                {% else %}
                    <option value="{{value}}" {% if value in content.get(key) %}selected{% endif %}>{{value}}</option>
                {% endif %}
            {% endfor %}
        </select>
        <label><span class='left' style="line-height: 1px;">&nbsp;</span></label>
        <div style="margin-top: -14px;">
            <a href="#" class="btn bnt-info btn-mini" onclick="jQuery('#{{key}} option').prop('selected', true); return false;">{{ __("Select all") }}</a>
            <a href="#" class="btn bnt-info btn-mini" onclick="jQuery('#{{key}} option').prop('selected', false); return false;">{{ __("Select none") }}</a>
        </div>

    {% else %}
        <select name="{{key}}" id="{{key}}" class='{% if field.class is defined %}{{ field.class }}{% endif %}'>
            {% for value in values %}
                {% if value is iterable and (value | length) > 1 %}
                    <option value="{{value[0]}}" {% if content.get(key)==value[0] %}selected{% endif %}>{{value[1:]|join(' / ')}}</option>
                {% else %}
                    <option value="{{value}}" {% if content.get(key)==value %}selected{% endif %}>{{value}}</option>
                {% endif %}
            {% endfor %}
        </select>
    {% endif %}
    </div>
{% endif %}

{# --------------- templateselect --------------- #}

{% if field.type == "templateselect" %}
    {{ macro.label(key, field, 'col-sm-3 control-label') }}
    <div class="col-sm-9">
        <select name="{{key}}" id="{{key}}" class='{{ field.class }}'>
            <option value="">{{ __('(default template)') }}</option>
            <option value="" disabled>-----------</option>
            {% for filename, name in listtemplates(field.filter) %}
                <option value="{{filename}}" {% if content.get(key)==filename %}selected{% endif %}>{{name}}</option>
            {% endfor %}
        </select>
    </div>
{% endif %}

{# --------------- image --------------- #}

{% if field.type == "image" %}
    {% if content.get(key) is not iterable %}
        {# This image was stored in the old format until re-saved #}
        {% set image = {'file': content.get(key)} %}
    {% else %}
        {% set image = content.get(key) %}
    {% endif %}

<div class="dropzone clearfix" id="dropzone-{{key}}">

    <div class="col-sm-9">


        {{ macro.label(key, field) }}
        <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label}}{% else %}{{ key|ucfirst}}{%endif%}"
              data-content="{{ app.translator.trans('info.upload.image',{},'infos') }}">{{ __('Info') }}</span>

        {# note: jQuery file-upload expects types separated by a '|', unlike the HTML spec. #}
        <input type="text" name="{{key}}[file]" id="field-{{key}}"
            value='{{ image.file|default('') }}'
            class='{% if field.class is defined %}{{ field.class }}{% endif %} imageinput wide'
            accept="{{ field.extensions|join('|') }}">

        <p class="filetypes">
            {{ __("Allowed filetypes are:") }} <code>{{ field.extensions|join("</code>, <code>")|raw }}</code>.
        </p>

        {% if field.attrib is defined %}

            {# If the user has set a single attribute as a string, convert it to an array #}
            {% if field.attrib is not iterable %}{% set attribs = {0: field.attrib} %}{% else %}{% set attribs = field.attrib %}{% endif %}

            {# We are only interested in the 'alt' attribute right now, but this will allow easy extension #}
            {% for attrib in attribs %}
	            {% if attrib == 'title' %}
                <div class="form-group" style="margin-top: 8px;">
                    <div class="col-sm-4">
	                   <label class="control-label" for="{{key}}[title]">{{ __('Title/Alt Text:') }} </label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" name="{{key}}[title]" id="{{key}}-title"
    	                    value='{{ image.title|default('') }}' class="form-control">
                    </div>
                </div>
	            {% endif %}
	        {% endfor %}

        {% endif %}

        <div style="margin-bottom: 10px; margin-top: 10px">
            <!-- The fileinput-button span is used to style the file input field as button -->
            <div class="btn-group">
                <span class="btn btn-secondary fileinput-button">
                    <i class="fa fa-upload"></i>
                    <span>{{ __('Upload image') }}</span>
                    <input id="fileupload-{{key}}" type="file" name="fileupload-{{key}}[]" data-url="{{ paths.app }}classes/upload/">
                </span>
            </div>

            <div class="btn-group" style="margin-left: 0px;">
                <a data-target="#selectModal-{{key}}" href="{{ paths.async }}browse/files?key={{ key }}" class="btn btn-tertiary" data-toggle="modal">
                    <i class="fa fa-download"></i>
                    {{ __('Select from server') }}
                </a>
            </div>

            {% set items = stackitems(7, 'image') %}
            {% if items %}
            <div class="btn-group">
                <a class="btn btn-tertiary dropdown-toggle" data-toggle="dropdown">
                    <i class="fa fa-paperclip"></i>
                    {{ __('Select from stack') }}
                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu" id="stack-{{key}}">
                    {% for item in items %}
                        <li>
                            <a href="#" data-action="stack.selectFromPulldown('{{ key }}', '{{ item.filepath }}');">{{ item.basename }} <small>({{ item.filesize }}, {{ item.imagesize }} px)</small></a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>


        <div class="progress progress-striped active" id="progress-{{key}}">
            <div class="bar" style="width: 0%;"></div>
        </div>

        <!-- Modal "select from server"  -->
        <div class="modal hide modal-wide" id="selectModal-{{key}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button class="btn btn-tertiary " data-dismiss="modal" aria-hidden="true">{{ __('Cancel') }}</button>
            </div>
        </div>

    </div><!-- col-sm-9 -->

    <div class="col-sm-3">
        <div class='imageholder' id="thumbnail-{{key}}">
            {% if content.get(key)!="" %}
                <img src="{{ image.file|thumbnail(120, 120, 'c') }}" width="120" height="120">
            {% else %}
                <img src="{{ app.paths.app }}view/img/default_empty.png" width="120" height="120">
            {% endif %}
        </div>
    </div><!-- col-sm-3 -->

</div><!-- dropzone -->

    {% if not ismobileclient() %}
    <script type="text/javascript">
        $(function() {
            bindFileUpload('{{key}}');

            $("#field-{{key}}").autocomplete({
                source: "{{ paths.async }}filesautocomplete?ext=gif,jpg,jpeg,png",
                minLength: 2,
                close: function(){
                    if ($('#field-{{key}}').val() != "" ) {
                        $('#thumbnail-{{key}}').html("<img src='{{ app.paths.root }}thumbs/120x120c/"+encodeURI( $('#field-{{key}}').val() )+"' width='120' height='120'>");
                    } else {
                        $('#thumbnail-{{key}}').html("<img src='{{ app.paths.app }}view/img/default_empty.png' width='120' height='120'>");
                    }
                }
            });

        });
    </script>
    {% endif %}

{% endif %}



{# --------------- file --------------- #}

{% if field.type == "file" %}
<div class="col-sm-12 dropzone clearfix" id="dropzone-{{key}}">

    {{ macro.label(key, field) }}
        <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label}}{% else %}{{ key|ucfirst}}{%endif%}"
              data-content="{{ app.translator.trans('info.upload.file',{},'infos') }}">{{ __('Info') }}</span>
    </label>

    <input type="text" name="{{key}}" id="field-{{key}}"
        value='{{ content.get(key) }}'
        class='{% if field.class is defined %}{{ field.class }}{% endif %} imageinput'
        {% if field.extensions is defined %}accept="{{ field.extensions|join('|') }}"{% endif %} ><br>

    <div style="margin-bottom: 10px; margin-top: 10px;">
        <!-- The fileinput-button span is used to style the file input field as button -->
        <div class="btn-group">
            <span class="btn btn-info fileinput-button">
                <i class="fa fa-upload"></i>
                <span>{{ __('Upload File') }}</span>
                <input id="fileupload-{{key}}" type="file" name="fileupload-{{key}}[]" data-url="{{ paths.app }}classes/upload/index.php"  accept=".{{ field.extensions|join(",.") }}">
            </span>
        </div>

        {% set items = stackitems(7, 'other,document') %}
        {% if items %}
            <div class="btn-group">
                <a class="btn btn-tertiary dropdown-toggle" data-toggle="dropdown">
                    <i class="fa fa-paperclip"></i>
                    {{ __('Select from stack') }}
                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu" id="stack-{{key}}">
                    {% for item in items %}
                        <li>
                            <a href="#" data-action="stack.selectFromPulldown('{{ key }}', '{{ item.filepath }}');">{{ item.basename }} <small>({{ item.filesize }})</small></a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>

    <div class="progress progress-striped active" id="progress-{{key}}">
        <div class="bar" style="width: 0%;"></div>
    </div>

    {% if not ismobileclient() %}
        <div style="clear: left;" class="hidden-sm"><small>{{ app.translator.trans('info.upload.filesmall',{},'infos') }}</small></div>
        <script type="text/javascript">
            $(function() {
                bindFileUpload('{{key}}');

                $("#field-{{key}}").autocomplete({
                    source: "{{ paths.async }}filesautocomplete?ext={{ field.extensions|join(',') }}",
                    minLength: 2
                });

            });
        </script>
    {% endif %}

</div>
{% endif %}


{# --------------- imagelist --------------- #}

{% if field.type == "imagelist" %}

<div class="imagelistholder dropzone" id="imagelist-{{key}}">
    <div class="col-sm-12">
        {{ macro.label(key, field) }}
        <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label|trans}}{% else %}{{ key|ucfirst|trans}}{%endif%}"
              data-content="{{ app.translator.trans('info.upload.filelist',{},'infos') }}">{{ __('Info') }}</span>
    </div>
    <div class="col-sm-9">
        <div class="list"></div>
    </div>

    <div class="buttons col-sm-3">
        <div class="btn-group" style="margin: 0 0 6px;">
            <span class="btn btn-info fileinput-button">
                <i class="fa fa-upload"></i>
                <span>{{ __('Upload image') }}</span>
                <input id="fileupload-{{key}}" type="file" name="fileupload-{{key}}[]" data-url="{{ paths.app }}classes/upload/"
                   {% if field.extensions is defined %}accept="{{ field.extensions|join('|') }}"{% endif %} >
            </span>

        </div>
        <div class="btn-group" style="margin: 0 0 6px;">
            <a data-target="#selectModal-{{key}}" href="{{ paths.async }}browse/files?key={{ key }}" class="btn btn-tertiary fileinput-select" data-toggle="modal">
                <i class="fa fa-download"></i>
                {{ __('Select from server') }}
            </a>
        </div>

        {% set items = stackitems(7, 'image') %}
        {% if items %}
        <div class="btn-group" style="margin: 0 0 6px;">
            <a class="btn btn-tertiary dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-paperclip"></i>
                {{ __('Select from stack') }}
                <span class="caret"></span>
            </a>

            <ul class="dropdown-menu" id="stack-{{key}}">
                {% for item in items %}
                    <li>
                        <a href="#" data-action="stack.selectFromPulldown('{{ key }}', '{{ item.filepath }}');">{{ item.basename }} <small>({{ item.filesize }}, {{ item.imagesize }} px)</small></a>
                    </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

    </div>
    <textarea name="{{key}}" id="{{key}}" class="hide">{% if content.get(key) is defined %}{{ content.get(key) }}{% endif %}</textarea>

    <!-- Modal "select from server"  -->
    <div class="modal hide modal-wide" id="selectModal-{{key}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-body">
        </div>
        <div class="modal-footer">
            <button class="btn btn-tertiary " data-dismiss="modal" aria-hidden="true">{{ __('Close') }}</button>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(function() {

        if(typeof imagelist == "undefined") {
            imagelist = [];
        }

        imagelist['{{ key }}'] = new ImagelistHolder({id: '{{key}}'});
    });
</script>

{% endif %}


{# --------------- filelist --------------- #}

{% if field.type == "filelist" %}

<div class="filelistholder dropzone" id="filelist-{{key}}">
    <div class="col-sm-12">
        {{ macro.label(key, field) }}
        <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label|trans}}{% else %}{{ key|ucfirst|trans}}{%endif%}"
          data-content="{{ app.translator.trans('info.upload.filelist',{},'infos') }}">{{ __('Info') }}</span>
    </div>
    <div class="col-sm-9">
        <div class="list"></div>
    </div>

    <div class="buttons col-sm-3">
        <div class="btn-group" style="margin: 0 0 6px;">
        <span class="btn btn-info fileinput-button">
            <i class="fa fa-upload"></i>
            <span>{{ __('Upload file') }}</span>
            <input id="fileupload-{{key}}"
                   type="file"
                   name="fileupload-{{key}}[]"
                   data-url="{{ paths.app }}classes/upload/index.php"
                   accept="{{ field.extensions|join('|') }}">
        </span>

        </div>
        <div class="btn-group" style="margin: 0 0 6px;">
            <a data-target="#selectModal-{{key}}" href="{{ paths.async }}browse/files?key={{ key }}" class="btn btn-tertiary fileinput-select" data-toggle="modal">
                <i class="fa fa-download"></i>
                {{ __('Select from server') }}
            </a>
        </div>

        {% set items = stackitems(7, 'other,document') %}
        {% if items %}
            <div class="btn-group" style="margin: 0 0 6px;">
                <a class="btn btn-tertiary dropdown-toggle" data-toggle="dropdown">
                    <i class="fa fa-paperclip"></i>
                    {{ __('Select from stack') }}
                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu" id="stack-{{key}}">
                    {% for item in items %}
                        <li>
                            <a href="#" data-action="stack.selectFromPulldown('{{ key }}', '{{ item.filepath }}');">{{ item.basename }} <small>({{ item.filesize }})</small></a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

    </div>
    <textarea name="{{key}}" id="{{key}}" class="hide">{% if content.get(key) is defined %}{{ content.get(key) }}{% endif %}</textarea>

    <!-- Modal "select from server"  -->
    <div class="modal hide modal-wide" id="selectModal-{{key}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-body">
        </div>
        <div class="modal-footer">
            <button class="btn btn-tertiary " data-dismiss="modal" aria-hidden="true">{{ __('Close') }}</button>
        </div>
    </div>
</div>



<script type="text/javascript">
    $(function() {

        if(typeof filelist == "undefined") {
            filelist = [];
        }

        filelist['{{ key }}'] = new FilelistHolder({id: '{{key}}'});
    });
</script>

{% endif %}

{# --------------- video --------------- #}

{% if field.type == "video" %}

{% set video = content.get(key) %}

    <div class="col-sm-8">

        {{ macro.label(key, field) }}

            (<span id="video-{{key}}-text">{% if video.title is defined %}"{{ video.title|trimtext(18) }}" by {{ video.authorname|trimtext(18) }}{% endif %}</span>)
            <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label|trans}}{% else %}{{ key|ucfirst|trans}}{%endif%}"
                  data-content="{{ app.translator.trans('info.upload.video',{},'infos') }}">{{ __('Info') }}</span>

        <div class="form-group">
            <div class="col-sm-2">
                {{ macro.label(__('URL:')) }}
            </div>
            <div class="col-sm-10">
                <input type="url" name="{{key}}[url]" id="video-{{key}}" value='{{ video.url|default('') }}' class="form-control">
            </div>

        </div>
        <div class="form-group">
            <div class="col-sm-2">
                {{ macro.label(__('Size:')) }}
            </div>
            <div class="col-sm-10">
                <input type="number" name="{{ key }}[width]" id="video-{{key}}-width" value="{{ video.width|default('') }}" class="form-control pull-left" style='width: 60px; min-width: 60px;'>
                <span class="pull-left" style="margin: 6px 8px 0;">x</span>
                <input type="number" name="{{ key }}[height]" id="video-{{key}}-height" value="{{ video.height|default('') }}" class="form-control pull-left" style='width: 60px; min-width: 60px;'>
                <span class="pull-left" style="margin: 6px 8px 0;">{{ __('pixels') }}</span>

            </div>

            <div class="col-sm-12">
                <span class="hidden-sm">
                    <a href="#myModal" role="button" class="btn btn-tertiary " data-toggle="modal" style='float: right;'>{{ __('Preview video') }}</a>
                </span>
            </div>


            <input type="hidden" name="{{ key }}[ratio]" id="video-{{key}}-ratio" value="{{ video.ratio|default('') }}">
            <input type="hidden" name="{{ key }}[title]" id="video-{{key}}-title" value="{{ video.title|default('') }}" readonly>
            <input type="hidden" name="{{ key }}[authorname]" id="video-{{key}}-author_name" value="{{ video.authorname|default('') }}" readonly>
            <input type="hidden" name="{{ key }}[authorurl]" id="video-{{key}}-author_url" value="{{ video.authorurl|default('') }}" readonly>
            <input type="hidden" name="{{ key }}[html]" id="video-{{key}}-html" value="{% if video.html is defined %}{{ video.html|escape }}{% endif %}">
            <input type="hidden" name="{{ key }}[thumbnail]" id="video-{{key}}-thumbnail" value="{{ video.thumbnail|default('') }}">

        </div>

        <script type="text/javascript">
            bindVideoEmbed('{{key}}');
        </script>
    </div>

    <div class="col-sm-4">
        <div class='imageholder' id="thumbnail-{{key}}" style="width: 160px; text-align: center; background-color: #F8F8F8;">
            {% if video.thumbnail|default('') %}
                <img src="{{ video.thumbnail }}" width="160" height="120">
            {% else %}
                <img src="{{ app.paths.app }}view/img/default_empty.png" width="120" height="120">
            {% endif %}
        </div>
    </div>

<!-- Modal video preview -->
<div class="modal hide" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

    <div class="modal-body">
        {% if video.html is defined %}
        {{ video.html }}
        {% else %}
        <p>{{ __('No video url is set, no video to show.') }}</p>
        {% endif %}
    </div>
    <div class="modal-footer">
        <button class="btn btn-tertiary " data-dismiss="modal" aria-hidden="true">{{ __('Close') }}</button>
    </div>
</div>


{% endif %}





{# --------------- geolocation --------------- #}

{% if field.type == "geolocation" %}

{% set geolocation = content.get(key) %}

    <div class="col-sm-8">

        {{ macro.label(key, field) }}

        <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label|trans}}{% else %}{{ key|ucfirst|trans}}{%endif%}"
                  data-content="{{ app.translator.trans('info.geolocation',{},'infos') }}">{{ __('Info') }}</span>

        <div class="form-group">

            <div class="col-sm-12">
                <label>{{ __('Address lookup:') }}</label>
                <input type="text" name="{{key}}[address]" id="{{key}}-address"
                                          value='{{ geolocation.address|default('') }}' class="form-control">
            </div>

        </div>

        <div class="form-group">
            <div class="col-sm-12">
                <span class="pull-left" style="margin: 6px 8px 0 0;">{{ __('Latitude:') }}</span>
                <input type="text" name="{{key}}[latitude]" id="{{key}}-latitude" value='{{ geolocation.latitude|default('') }}' class="form-control pull-left" style='width: 28%;'>
                <span class="pull-left" style="margin: 6px 8px 0;">- {{ __('Longitude:') }}</span>
                <input type="text" name="{{key}}[longitude]" id="{{key}}-longitude" value='{{ geolocation.longitude|default('') }}' class="form-control pull-left" style='width: 28%;'>
            </div>

        </div>
        <div class="form-group">
            <div class="col-sm-12">
                <p>{{ __('Matched address:') }}
                    <span id="{{ key }}-reversegeo"> {{ geolocation.formatted_address|default('') }}</span></p>
                <input type="hidden" name="{{key}}[formatted_address]" id="{{key}}-formatted_address"
                       value='{{ geolocation.formatted_address|default('') }}' style='width: 30%;'>
            </div>
        </div>
    </div>

    <div class="col-sm-4" style="padding-left: 0;">
            <div class='mapholder' id="map-{{key}}" style="width: 204px;">
                <img src="{{ geo.map|default('') }}" width="200" height="200">
            </div>
    </div>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{ paths.app }}view/js/jquery.gomap-1.3.2.min.js"></script>
<script type="text/javascript">
    $(function() {
        bindGeolocation('{{key}}', '{{ geolocation.latitude|default('') }}', '{{ geolocation.longitude|default('') }}');
    });
</script>

{% endif %}


{# --------------- html --------------- #}

{% if field.type == "html" %}
    <div class="col-sm-12">
    {{ macro.label(key, field) }}
    <textarea name="{{key}}" class='{{ field.class }} ckeditor'
        style='{% if field.height is defined %}height: {{ field.height }}{% endif %}'
        {{ macro.requiredattr(field) }}
        >{% if content.get(key) is defined %}{{ content.get(key) }}{% endif %}
    </textarea>
    </div>
{% endif %}

{# --------------- textarea --------------- #}

{% if field.type == "textarea" %}
    <div class="col-sm-12">
        {{ macro.label(key, field) }}
    <textarea name="{{key}}" class='{{ field.class }}'
        style='{% if field.height is defined %}height: {{ field.height }}{% endif %}'
        {{ macro.requiredattr(field) }}
        >{% if content.get(key) is defined %}{{ content.get(key) }}{% endif %}</textarea>
    </div>
{% endif %}


{# --------------- textarea --------------- #}

{% if field.type == "markdown" %}
    <div class="col-sm-12">
    {{ macro.label(key, field) }}
        <span class="label info-pop" data-html="true" data-title="{% if field.label %}{{field.label}}{% else %}{{ key|ucfirst}}{%endif%}"
              data-content="{{ app.translator.trans('info.markdown',{},'infos') }}">{{ __('Info') }}</span>

    <textarea id="{{ key }}" name="{{key}}" class='{{ field.class }}'
        style='{% if field.height is defined %}height: {{ field.height }} !important;{% endif %}'
        {{ macro.requiredattr(field) }}
        >{% if content.get(key) is defined %}{{ content.get(key) }}{% endif %}</textarea>

    <textarea id="jquery-catchpaste-textarea" style="position: absolute; width: 0 !important; height: 0; left: -10000px;"></textarea>
    </div>
<!-- script snippet for markdown {{ key }} -->
<script type="text/javascript">
    $(function() {
        bindMarkdown('{{key}}');
    });
</script>

{% endif %}


{# --------------- date --------------- #}

{% if field.type == "date" %}
    {{ macro.label(key, field, 'col-sm-3 control-label') }}
    <div class="col-sm-9">
        <input type="text" name="{{key}}-dateformatted" id="{{key}}-date"
               value='{% if content.get(key) and (content.get(key) > "0001-01-01 00:00:00") %}{{ content.get(key)|date('l, d F Y') }}{% endif %}'
               class='{{ field.class }} datepicker'>
        <input type="hidden" name="{{key}}" id="{{ key }}" value="{{ content.get(key)|date('Y-m-d H:i:s') }}">
    </div>
    <!-- script snippet for datefield {{ key }} -->
    <script type="text/javascript">
        $(function() {
            $('#{{key}}-date').on('change.bolt', function(){
                var date = $('#{{key}}-date').datepicker( "getDate" );
                $('#{{ key }}').val($.datepicker.formatDate('yy-mm-dd', date));
            }).trigger('change.bolt');
        });
    </script>
{% endif %}


{# --------------- datetime --------------- #}

{% if field.type == "datetime" %}
    {{ macro.label(key, field, 'col-sm-3 control-label') }}
    <div class="col-sm-9">
        <input type="text" name="{{key}}-dateformatted" id="{{key}}-date"
               value='{% if content.get(key) and (content.get(key) > "0001-01-01 00:00:00") %}{{ content.get(key)|date('l, d F Y') }}{% endif %}'
               class='{{ field.class }} datepicker'>
        <input type="time" name="{{key}}-timeformatted" id="{{key}}-time"
               value='{% if content.get(key) and (content.get(key) > "0001-01-01 00:00:00") %}{{ content.get(key)|date('H:i') }}{% endif %}'
               class='{{ field.class }} timepicker'>
        <input type="hidden" name="{{key}}" id="{{ key }}" value="{{ content.get(key)|date('Y-m-d H:i:s') }}">
    </div>
    <!-- script snippet for datetime field {{ key }} -->
    <script type="text/javascript">

    $(function() {
        $('#{{key}}-date, #{{key}}-time').on('change.bolt', function(){
            var date = $('#{{key}}-date').datepicker("getDate");
            var time = $('#{{key}}-time').val() + ":00";
            $('#{{ key }}').val($.datepicker.formatDate('yy-mm-dd', date)+" "+time);
        }).trigger('change.bolt');
    });
    </script>
{% endif %}

{# ---------------postfix & divider --------------- #}

{% if field.postfix is defined and field.postfix is not empty %}
    <div class='col-sm-12'>
        {{ field.postfix|raw }}
    </div>
{% endif %}

</div><!-- end of 'formgroup' -->

{% if field.separator is defined and field.separator == true %}
    <hr>
{% endif %}


{% endfor %}

