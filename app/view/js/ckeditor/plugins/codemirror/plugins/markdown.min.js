!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],t):t(CodeMirror)}(function(_){"use strict";_.defineMode("markdown",function(c,L){var T=_.getMode(c,"text/html"),r="null"==T.name;void 0===L.highlightFormatting&&(L.highlightFormatting=!1),void 0===L.maxBlockquoteDepth&&(L.maxBlockquoteDepth=0),void 0===L.taskLists&&(L.taskLists=!1),void 0===L.strikethrough&&(L.strikethrough=!1),void 0===L.emoji&&(L.emoji=!1),void 0===L.fencedCodeBlockHighlighting&&(L.fencedCodeBlockHighlighting=!0),void 0===L.xml&&(L.xml=!0),void 0===L.tokenTypeOverrides&&(L.tokenTypeOverrides={});var q={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough",emoji:"builtin"};for(var t in q)q.hasOwnProperty(t)&&L.tokenTypeOverrides[t]&&(q[t]=L.tokenTypeOverrides[t]);var d=/^([*\-_])(?:\s*\1){2,}\s*$/,k=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,M=/^\[(x| )\](?=\s)/i,p=L.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,x=/^ *(?:\={1,}|-{1,})\s*$/,i=/^[^#!\[\]*_\\<>` "'(~:]+/,v=/^(~~~+|```+)[ \t]*([\w+#-]*)[^\n`]*$/,S=/^\s*\[[^\]]+?\]:.*$/,F=/[!\"#$%&\'()*+,\-\.\/:;<=>?@\[\\\]^_`{|}~â€”]/;function b(t,e,i){return e.f=e.inline=i,i(t,e)}function E(t,e,i){return e.f=e.block=i,i(t,e)}function n(t){return t.linkTitle=!1,t.linkHref=!1,t.linkText=!1,t.em=!1,t.strong=!1,t.strikethrough=!1,t.quote=0,t.indentedCode=!1,t.f==w&&(t.f=C,t.block=l),t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.prevLine=t.thisLine,t.thisLine={stream:null},null}function l(t,e){var i,n=t.column()===e.indentation,r=!(i=e.prevLine.stream)||!/\S/.test(i.string),a=e.indentedCode,l=e.prevLine.hr,o=!1!==e.list,h=(e.listStack[e.listStack.length-1]||0)+3;e.indentedCode=!1;var g=e.indentation;if(null===e.indentationDiff&&(e.indentationDiff=e.indentation,o)){for(e.em=!1,e.strong=!1,e.code=!1,e.strikethrough=!1,e.list=null;g<e.listStack[e.listStack.length-1];)e.listStack.pop(),e.listStack.length?e.indentation=e.listStack[e.listStack.length-1]:e.list=!1;!1!==e.list&&(e.indentationDiff=g-e.listStack[e.listStack.length-1])}var s=!(r||l||e.prevLine.header||o&&a||e.prevLine.fencedCodeEnd),m=(!1===e.list||l||r)&&e.indentation<=h&&t.match(d),u=null;if(4<=e.indentationDiff&&(a||e.prevLine.fencedCodeEnd||e.prevLine.header||r))return t.skipToEnd(),e.indentedCode=!0,q.code;if(t.eatSpace())return null;if(n&&e.indentation<=h&&(u=t.match(p))&&u[1].length<=6)return e.quote=0,e.header=u[1].length,e.thisLine.header=!0,L.highlightFormatting&&(e.formatting="header"),e.f=e.inline,y(e);if(e.indentation<=h&&t.eat(">"))return e.quote=n?1:e.quote+1,L.highlightFormatting&&(e.formatting="quote"),t.eatSpace(),y(e);if(!m&&!e.setext&&n&&e.indentation<=h&&(u=t.match(k))){var f=u[1]?"ol":"ul";return e.indentation=g+t.current().length,e.list=!0,e.quote=0,e.listStack.push(e.indentation),L.taskLists&&t.match(M,!1)&&(e.taskList=!0),e.f=e.inline,L.highlightFormatting&&(e.formatting=["list","list-"+f]),y(e)}return n&&e.indentation<=h&&(u=t.match(v,!0))?(e.quote=0,e.fencedEndRE=new RegExp(u[1]+"+ *$"),e.localMode=L.fencedCodeBlockHighlighting&&function(t){if(_.findModeByName){var e=_.findModeByName(t);e&&(t=e.mime||e.mimes[0])}var i=_.getMode(c,t);return"null"==i.name?null:i}(u[2]),e.localMode&&(e.localState=_.startState(e.localMode)),e.f=e.block=j,L.highlightFormatting&&(e.formatting="code-block"),e.code=-1,y(e)):e.setext||!(s&&o||e.quote||!1!==e.list||e.code||m||S.test(t.string))&&(u=t.lookAhead(1))&&(u=u.match(x))?(e.setext?(e.header=e.setext,e.setext=0,t.skipToEnd(),L.highlightFormatting&&(e.formatting="header")):(e.header="="==u[0].charAt(0)?1:2,e.setext=e.header),e.thisLine.header=!0,e.f=e.inline,y(e)):m?(t.skipToEnd(),e.hr=!0,e.thisLine.hr=!0,q.hr):"["===t.peek()?b(t,e,D):b(t,e,e.inline)}function w(t,e){var i=T.token(t,e.htmlState);if(!r){var n=_.innerMode(T,e.htmlState);("xml"==n.mode.name&&null===n.state.tagStart&&!n.state.context&&n.state.tokenize.isInText||e.md_inside&&-1<t.current().indexOf(">"))&&(e.f=C,e.block=l,e.htmlState=null)}return i}function j(t,e){var i,n=e.listStack[e.listStack.length-1]||0,r=e.indentation<n,a=n+3;return e.fencedEndRE&&e.indentation<=a&&(r||t.match(e.fencedEndRE))?(L.highlightFormatting&&(e.formatting="code-block"),r||(i=y(e)),e.localMode=e.localState=null,e.block=l,e.f=C,e.fencedEndRE=null,e.code=0,e.thisLine.fencedCodeEnd=!0,r?E(t,e,e.block):i):e.localMode?e.localMode.token(t,e.localState):(t.skipToEnd(),q.code)}function y(t){var e=[];if(t.formatting){e.push(q.formatting),"string"==typeof t.formatting&&(t.formatting=[t.formatting]);for(var i=0;i<t.formatting.length;i++)e.push(q.formatting+"-"+t.formatting[i]),"header"===t.formatting[i]&&e.push(q.formatting+"-"+t.formatting[i]+"-"+t.header),"quote"===t.formatting[i]&&(!L.maxBlockquoteDepth||L.maxBlockquoteDepth>=t.quote?e.push(q.formatting+"-"+t.formatting[i]+"-"+t.quote):e.push("error"))}if(t.taskOpen)return e.push("meta"),e.length?e.join(" "):null;if(t.taskClosed)return e.push("property"),e.length?e.join(" "):null;if(t.linkHref?e.push(q.linkHref,"url"):(t.strong&&e.push(q.strong),t.em&&e.push(q.em),t.strikethrough&&e.push(q.strikethrough),t.emoji&&e.push(q.emoji),t.linkText&&e.push(q.linkText),t.code&&e.push(q.code),t.image&&e.push(q.image),t.imageAltText&&e.push(q.imageAltText,"link"),t.imageMarker&&e.push(q.imageMarker)),t.header&&e.push(q.header,q.header+"-"+t.header),t.quote&&(e.push(q.quote),!L.maxBlockquoteDepth||L.maxBlockquoteDepth>=t.quote?e.push(q.quote+"-"+t.quote):e.push(q.quote+"-"+L.maxBlockquoteDepth)),!1!==t.list){var n=(t.listStack.length-1)%3;n?1===n?e.push(q.list2):e.push(q.list3):e.push(q.list1)}return t.trailingSpaceNewLine?e.push("trailing-space-new-line"):t.trailingSpace&&e.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),e.length?e.join(" "):null}function e(t,e){if(t.match(i,!0))return y(e)}function C(t,e){var i=e.text(t,e);if(void 0!==i)return i;if(e.list)return e.list=null,y(e);if(e.taskList)return" "===t.match(M,!0)[1]?e.taskOpen=!0:e.taskClosed=!0,L.highlightFormatting&&(e.formatting="task"),e.taskList=!1,y(e);if(e.taskOpen=!1,e.taskClosed=!1,e.header&&t.match(/^#+$/,!0))return L.highlightFormatting&&(e.formatting="header"),y(e);var n=t.next();if(e.linkTitle){e.linkTitle=!1;var r=n;"("===n&&(r=")");var a="^\\s*(?:[^"+(r=(r+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1"))+"\\\\]+|\\\\\\\\|\\\\.)"+r;if(t.match(new RegExp(a),!0))return q.linkHref}if("`"===n){var l=e.formatting;L.highlightFormatting&&(e.formatting="code"),t.eatWhile("`");var o=t.current().length;if(0!=e.code||e.quote&&1!=o){if(o==e.code){var h=y(e);return e.code=0,h}return e.formatting=l,y(e)}return e.code=o,y(e)}if(e.code)return y(e);if("\\"===n&&(t.next(),L.highlightFormatting)){var g=y(e),s=q.formatting+"-escape";return g?g+" "+s:s}if("!"===n&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return e.imageMarker=!0,e.image=!0,L.highlightFormatting&&(e.formatting="image"),y(e);if("["===n&&e.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return e.imageMarker=!1,e.imageAltText=!0,L.highlightFormatting&&(e.formatting="image"),y(e);if("]"===n&&e.imageAltText){L.highlightFormatting&&(e.formatting="image");var g=y(e);return e.imageAltText=!1,e.image=!1,e.inline=e.f=B,g}if("["===n&&!e.image)return e.linkText=!0,L.highlightFormatting&&(e.formatting="link"),y(e);if("]"===n&&e.linkText){L.highlightFormatting&&(e.formatting="link");var g=y(e);return e.linkText=!1,e.inline=e.f=t.match(/\(.*?\)| ?\[.*?\]/,!1)?B:C,g}if("<"===n&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return e.f=e.inline=H,L.highlightFormatting&&(e.formatting="link"),(g=y(e))?g+=" ":g="",g+q.linkInline;if("<"===n&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return e.f=e.inline=H,L.highlightFormatting&&(e.formatting="link"),(g=y(e))?g+=" ":g="",g+q.linkEmail;if(L.xml&&"<"===n&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^>]+)?)*\s*>)/i,!1)){var m=t.string.indexOf(">",t.pos);if(-1!=m){var u=t.string.substring(t.start,m);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(u)&&(e.md_inside=!0)}return t.backUp(1),e.htmlState=_.startState(T),E(t,e,w)}if(L.xml&&"<"===n&&t.match(/^\/\w*?>/))return e.md_inside=!1,"tag";if("*"===n||"_"===n){for(var f=1,c=1==t.pos?" ":t.string.charAt(t.pos-2);f<3&&t.eat(n);)f++;var d=t.peek()||" ",k=!/\s/.test(d)&&(!F.test(d)||/\s/.test(c)||F.test(c)),p=!/\s/.test(c)&&(!F.test(c)||/\s/.test(d)||F.test(d)),x=null,v=null;if(f%2&&(e.em||!k||"*"!==n&&p&&!F.test(c)?e.em!=n||!p||"*"!==n&&k&&!F.test(d)||(x=!1):x=!0),1<f&&(e.strong||!k||"*"!==n&&p&&!F.test(c)?e.strong!=n||!p||"*"!==n&&k&&!F.test(d)||(v=!1):v=!0),null!=v||null!=x){L.highlightFormatting&&(e.formatting=null==x?"strong":null==v?"em":"strong em"),!0===x&&(e.em=n),!0===v&&(e.strong=n);h=y(e);return!1===x&&(e.em=!1),!1===v&&(e.strong=!1),h}}else if(" "===n&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return y(e);t.backUp(1)}if(L.strikethrough)if("~"===n&&t.eatWhile(n)){if(e.strikethrough){L.highlightFormatting&&(e.formatting="strikethrough");h=y(e);return e.strikethrough=!1,h}if(t.match(/^[^\s]/,!1))return e.strikethrough=!0,L.highlightFormatting&&(e.formatting="strikethrough"),y(e)}else if(" "===n&&t.match(/^~~/,!0)){if(" "===t.peek())return y(e);t.backUp(2)}if(L.emoji&&":"===n&&t.match(/^[a-z_\d+-]+:/)){e.emoji=!0,L.highlightFormatting&&(e.formatting="emoji");var S=y(e);return e.emoji=!1,S}return" "===n&&(t.match(/ +$/,!1)?e.trailingSpace++:e.trailingSpace&&(e.trailingSpaceNewLine=!0)),y(e)}function H(t,e){if(">"===t.next()){e.f=e.inline=C,L.highlightFormatting&&(e.formatting="link");var i=y(e);return i?i+=" ":i="",i+q.linkInline}return t.match(/^[^>]+/,!0),q.linkInline}function B(t,e){if(t.eatSpace())return null;var r,i=t.next();return"("===i||"["===i?(e.f=e.inline=(r="("===i?")":"]",function(t,e){var i=t.next();if(i===r){e.f=e.inline=C,L.highlightFormatting&&(e.formatting="link-string");var n=y(e);return e.linkHref=!1,n}return t.match(a[r]),e.linkHref=!0,y(e)}),L.highlightFormatting&&(e.formatting="link-string"),e.linkHref=!0,y(e)):"error"}var a={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/};function D(t,e){return t.match(/^([^\]\\]|\\.)*\]:/,!1)?(e.f=o,t.next(),L.highlightFormatting&&(e.formatting="link"),e.linkText=!0,y(e)):b(t,e,C)}function o(t,e){if(t.match(/^\]:/,!0)){e.f=e.inline=h,L.highlightFormatting&&(e.formatting="link");var i=y(e);return e.linkText=!1,i}return t.match(/^([^\]\\]|\\.)+/,!0),q.linkText}function h(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),e.f=e.inline=C,q.linkHref+" url")}var g={startState:function(){return{f:l,prevLine:{stream:null},thisLine:{stream:null},block:l,htmlState:null,indentation:0,inline:C,text:e,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,setext:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,emoji:!1,fencedEndRE:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&_.copyState(T,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?_.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkText:t.linkText,linkTitle:t.linkTitle,linkHref:t.linkHref,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,emoji:t.emoji,header:t.header,setext:t.setext,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedEndRE:t.fencedEndRE}},token:function(t,e){if(e.formatting=!1,t!=e.thisLine.stream){if(e.header=0,e.hr=!1,t.match(/^\s*$/,!0))return n(e),null;if(e.prevLine=e.thisLine,e.thisLine={stream:t},e.taskList=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,!e.localState&&(e.f=e.block,e.f!=w)){var i=t.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(e.indentation=i,e.indentationDiff=null,0<i)return null}}return e.f(t,e)},innerMode:function(t){return t.block==w?{state:t.htmlState,mode:T}:t.localState?{state:t.localState,mode:t.localMode}:{state:t,mode:g}},indent:function(t,e,i){return t.block==w&&T.indent?T.indent(t.htmlState,e,i):t.localState&&t.localMode.indent?t.localMode.indent(t.localState,e,i):_.Pass},blankLine:n,getType:y,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return g},"xml"),_.defineMIME("text/markdown","markdown"),_.defineMIME("text/x-markdown","markdown")});