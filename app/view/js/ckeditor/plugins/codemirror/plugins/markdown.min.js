// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE
!function(a){"object"==typeof exports&&"object"==typeof module?// CommonJS
a(require("../../lib/codemirror",require("../xml/xml"))):"function"==typeof define&&define.amd?// AMD
define(["../../lib/codemirror","../xml/xml"],a):// Plain browser env
a(CodeMirror)}(function(a){"use strict";a.defineMode("markdown",function(b,c){function d(a,b,c){return b.f=b.inline=c,c(a,b)}function e(a,b,c){return b.f=b.block=c,c(a,b)}
// Blocks
function f(a){
// Reset linkTitle state
// Reset EM state
// Reset STRONG state
// Reset state.quote
// Reset state.trailingSpace
// Mark this line as blank
return a.linkTitle=!1,a.em=!1,a.strong=!1,a.quote=0,t||a.f!=h||(a.f=l,a.block=g),a.trailingSpace=0,a.trailingSpaceNewLine=!1,a.thisLineHasContent=!1,null}function g(a,b){var f=a.sol(),g=b.list!==!1;b.list!==!1&&b.indentationDiff>=0?(// Continued list
b.indentationDiff<4&&(// Only adjust indentation if *not* a code block
b.indentation-=b.indentationDiff),b.list=null):b.list!==!1&&b.indentation>0?(b.list=null,b.listDepth=Math.floor(b.indentation/4)):b.list!==!1&&(// No longer a list
b.list=!1,b.listDepth=0);var h=null;if(b.indentationDiff>=4)return b.indentation-=4,a.skipToEnd(),z;if(a.eatSpace())return null;if(h=a.match(R))return b.header=h[0].length<=6?h[0].length:6,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,j(b);if(b.prevLineHasContent&&(h=a.match(S)))return b.header="="==h[0].charAt(0)?1:2,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,j(b);if(a.eat(">"))return b.indentation++,b.quote=f?1:b.quote+1,c.highlightFormatting&&(b.formatting="quote"),a.eatSpace(),j(b);if("["===a.peek())return d(a,b,p);if(a.match(N,!0))return E;if((!b.prevLineHasContent||g)&&(a.match(O,!1)||a.match(P,!1))){var k=null;return a.match(O,!0)?k="ul":(a.match(P,!0),k="ol"),b.indentation+=4,b.list=!0,b.listDepth++,c.taskLists&&a.match(Q,!1)&&(b.taskList=!0),b.f=b.inline,c.highlightFormatting&&(b.formatting=["list","list-"+k]),j(b)}
// try switching mode
return c.fencedCodeBlocks&&a.match(/^```([\w+#]*)/,!0)?(b.localMode=w(RegExp.$1),b.localMode&&(b.localState=b.localMode.startState()),e(a,b,i),c.highlightFormatting&&(b.formatting="code-block"),b.code=!0,j(b)):d(a,b,b.inline)}function h(a,b){var c=u.token(a,b.htmlState);return(t&&null===b.htmlState.tagStart&&!b.htmlState.context||b.md_inside&&a.current().indexOf(">")>-1)&&(b.f=l,b.block=g,b.htmlState=null),c}function i(a,b){if(a.sol()&&a.match(/^```/,!0)){b.localMode=b.localState=null,b.f=l,b.block=g,c.highlightFormatting&&(b.formatting="code-block"),b.code=!0;var d=j(b);return b.code=!1,d}return b.localMode?b.localMode.token(a,b.localState):(a.skipToEnd(),z)}
// Inline
function j(a){var b=[];if(a.formatting){b.push(G),"string"==typeof a.formatting&&(a.formatting=[a.formatting]);for(var d=0;d<a.formatting.length;d++)b.push(G+"-"+a.formatting[d]),"header"===a.formatting[d]&&b.push(G+"-"+a.formatting[d]+"-"+a.header),
// Add `formatting-quote` and `formatting-quote-#` for blockquotes
// Add `error` instead if the maximum blockquote nesting depth is passed
"quote"===a.formatting[d]&&(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(G+"-"+a.formatting[d]+"-"+a.quote):b.push("error"))}if(a.taskOpen)return b.push("meta"),b.length?b.join(" "):null;if(a.taskClosed)return b.push("property"),b.length?b.join(" "):null;if(a.linkHref)return b.push(K),b.length?b.join(" "):null;if(a.strong&&b.push(M),a.em&&b.push(L),a.linkText&&b.push(J),a.code&&b.push(z),a.header&&(b.push(y),b.push(y+"-"+a.header)),a.quote&&(b.push(A),
// Add `quote-#` where the maximum for `#` is modeCfg.maxBlockquoteDepth
!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(A+"-"+a.quote):b.push(A+"-"+c.maxBlockquoteDepth)),a.list!==!1){var e=(a.listDepth-1)%3;e?1===e?b.push(C):b.push(D):b.push(B)}return a.trailingSpaceNewLine?b.push("trailing-space-new-line"):a.trailingSpace&&b.push("trailing-space-"+(a.trailingSpace%2?"a":"b")),b.length?b.join(" "):null}function k(a,b){return a.match(T,!0)?j(b):void 0}function l(b,d){var f=d.text(b,d);if("undefined"!=typeof f)return f;if(d.list)// List marker (*, +, -, 1., etc)
return d.list=null,j(d);if(d.taskList){var g="x"!==b.match(Q,!0)[1];return g?d.taskOpen=!0:d.taskClosed=!0,c.highlightFormatting&&(d.formatting="task"),d.taskList=!1,j(d)}if(d.taskOpen=!1,d.taskClosed=!1,d.header&&b.match(/^#+$/,!0))return c.highlightFormatting&&(d.formatting="header"),j(d);
// Get sol() value now, before character is consumed
var i=b.sol(),k=b.next();if(d.escape)return d.escape=!1,j(d);if("\\"===k)return c.highlightFormatting&&(d.formatting="escape"),d.escape=!0,j(d);
// Matches link titles present on next line
if(d.linkTitle){d.linkTitle=!1;var l=k;"("===k&&(l=")"),l=(l+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var o="^\\s*(?:[^"+l+"\\\\]+|\\\\\\\\|\\\\.)"+l;if(b.match(new RegExp(o),!0))return K}
// If this block is changed, it may need to be updated in GFM mode
if("`"===k){var p=d.formatting;c.highlightFormatting&&(d.formatting="code");var q=j(d),r=b.pos;b.eatWhile("`");var s=1+b.pos-r;// Must be exact
return d.code?s===x?(d.code=!1,q):(d.formatting=p,j(d)):(x=s,d.code=!0,j(d))}if(d.code)return j(d);if("!"===k&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return b.match(/\[[^\]]*\]/),d.inline=d.f=n,F;if("["===k&&b.match(/.*\](\(| ?\[)/,!1))return d.linkText=!0,c.highlightFormatting&&(d.formatting="link"),j(d);if("]"===k&&d.linkText){c.highlightFormatting&&(d.formatting="link");var t=j(d);return d.linkText=!1,d.inline=d.f=n,t}if("<"===k&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=m,c.highlightFormatting&&(d.formatting="link");var t=j(d);return t?t+=" ":t="",t+H}if("<"===k&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=m,c.highlightFormatting&&(d.formatting="link");var t=j(d);return t?t+=" ":t="",t+I}if("<"===k&&b.match(/^\w/,!1)){if(-1!=b.string.indexOf(">")){var v=b.string.substring(1,b.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(v)&&(d.md_inside=!0)}return b.backUp(1),d.htmlState=a.startState(u),e(b,d,h)}if("<"===k&&b.match(/^\/\w*?>/))return d.md_inside=!1,"tag";var w=!1;if(!c.underscoresBreakWords&&"_"===k&&"_"!==b.peek()&&b.match(/(\w)/,!1)){var y=b.pos-2;if(y>=0){var z=b.string.charAt(y);"_"!==z&&z.match(/(\w)/,!1)&&(w=!0)}}if("*"===k||"_"===k&&!w)if(i&&" "===b.peek());else{if(d.strong===k&&b.eat(k)){// Remove STRONG
c.highlightFormatting&&(d.formatting="strong");var q=j(d);return d.strong=!1,q}if(!d.strong&&b.eat(k))// Add STRONG
return d.strong=k,c.highlightFormatting&&(d.formatting="strong"),j(d);if(d.em===k){// Remove EM
c.highlightFormatting&&(d.formatting="em");var q=j(d);return d.em=!1,q}if(!d.em)// Add EM
return d.em=k,c.highlightFormatting&&(d.formatting="em"),j(d)}else if(" "===k&&(b.eat("*")||b.eat("_"))){// Probably surrounded by spaces
if(" "===b.peek())// Surrounded by spaces, ignore
return j(d);// Not surrounded by spaces, back up pointer
b.backUp(1)}return" "===k&&(b.match(/ +$/,!1)?d.trailingSpace++:d.trailingSpace&&(d.trailingSpaceNewLine=!0)),j(d)}function m(a,b){var d=a.next();if(">"===d){b.f=b.inline=l,c.highlightFormatting&&(b.formatting="link");var e=j(b);return e?e+=" ":e="",e+H}return a.match(/^[^>]+/,!0),H}function n(a,b){
// Check if space, and return NULL if so (to avoid marking the space)
if(a.eatSpace())return null;var d=a.next();return"("===d||"["===d?(b.f=b.inline=o("("===d?")":"]"),c.highlightFormatting&&(b.formatting="link-string"),b.linkHref=!0,j(b)):"error"}function o(a){return function(b,d){var e=b.next();if(e===a){d.f=d.inline=l,c.highlightFormatting&&(d.formatting="link-string");var f=j(d);return d.linkHref=!1,f}return b.match(s(a),!0)&&b.backUp(1),d.linkHref=!0,j(d)}}function p(a,b){// Consume [
return a.match(/^[^\]]*\]:/,!1)?(b.f=q,a.next(),c.highlightFormatting&&(b.formatting="link"),b.linkText=!0,j(b)):d(a,b,l)}function q(a,b){if(a.match(/^\]:/,!0)){b.f=b.inline=r,c.highlightFormatting&&(b.formatting="link");var d=j(b);return b.linkText=!1,d}return a.match(/^[^\]]+/,!0),J}function r(a,b){
// Check if space, and return NULL if so (to avoid marking the space)
// Check if space, and return NULL if so (to avoid marking the space)
// Match URL
// Check for link title
// End of line, set flag to check next line
// More content on line, check if link title
return a.eatSpace()?null:(a.match(/^[^\s]+/,!0),void 0===a.peek()?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),b.f=b.inline=l,K)}function s(a){
// Escape endChar for RegExp (taken from http://stackoverflow.com/a/494122/526741)
// Match any non-endChar, escaped character, as well as the closing
// endChar.
return U[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),U[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")")),U[a]}var t=a.modes.hasOwnProperty("xml"),u=a.getMode(b,t?{name:"xml",htmlMode:!0}:"text/plain"),v={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},w=function(){var c,d,e={},f={},g=[];for(var h in a.modes)a.modes.propertyIsEnumerable(h)&&g.push(h);for(c=0;c<g.length;c++)e[g[c]]=g[c];var i=[];for(var h in a.mimeModes)a.mimeModes.propertyIsEnumerable(h)&&i.push({mime:h,mode:a.mimeModes[h]});for(c=0;c<i.length;c++)d=i[c].mime,f[d]=i[c].mime;for(var j in v)(v[j]in e||v[j]in f)&&(e[j]=v[j]);return function(c){return e[c]?a.getMode(b,e[c]):null}}();void 0===c.highlightFormatting&&(c.highlightFormatting=!1),
// Maximum number of nested blockquotes. Set to 0 for infinite nesting.
// Excess `>` will emit `error` token.
void 0===c.maxBlockquoteDepth&&(c.maxBlockquoteDepth=0),void 0===c.underscoresBreakWords&&(c.underscoresBreakWords=!0),void 0===c.fencedCodeBlocks&&(c.fencedCodeBlocks=!1),void 0===c.taskLists&&(c.taskLists=!1);var x=0,y="header",z="comment",A="quote",B="variable-2",C="variable-3",D="keyword",E="hr",F="tag",G="formatting",H="link",I="link",J="link",K="string",L="em",M="strong",N=/^([*\-=_])(?:\s*\1){2,}\s*$/,O=/^[*\-+]\s+/,P=/^[0-9]+\.\s+/,Q=/^\[(x| )\](?=\s)/,R=/^#+/,S=/^(?:\={1,}|-{1,})$/,T=/^[^#!\[\]*_\\<>` "'(]+/,U=[],V={startState:function(){return{f:g,prevLineHasContent:!1,thisLineHasContent:!1,block:g,htmlState:null,indentation:0,inline:l,text:k,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(b){return{f:b.f,prevLineHasContent:b.prevLineHasContent,thisLineHasContent:b.thisLineHasContent,block:b.block,htmlState:b.htmlState&&a.copyState(u,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,escape:!1,formatting:!1,linkTitle:b.linkTitle,em:b.em,strong:b.strong,header:b.header,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside}},token:function(a,b){if(
// Reset state.formatting
b.formatting=!1,a.sol()){var c=a.match(/^\s*$/,!0)||b.header;if(
// Reset state.header
b.header=0,c)return b.prevLineHasContent=!1,f(b);b.prevLineHasContent=b.thisLineHasContent,b.thisLineHasContent=!0,
// Reset state.escape
b.escape=!1,
// Reset state.taskList
b.taskList=!1,
// Reset state.code
b.code=!1,
// Reset state.trailingSpace
b.trailingSpace=0,b.trailingSpaceNewLine=!1,b.f=b.block;var d=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,e=4*Math.floor((d-b.indentation)/4);e>4&&(e=4);var g=b.indentation+e;if(b.indentationDiff=g-b.indentation,b.indentation=g,d>0)return null}var h=b.f(a,b);return a.start==a.pos?this.token(a,b):h},innerMode:function(a){return a.block==h?{state:a.htmlState,mode:u}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,mode:V}},blankLine:f,getType:j,fold:"markdown"};return V},"xml"),a.defineMIME("text/x-markdown","markdown")});