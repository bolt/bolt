!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/search/searchcursor",["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function x(g,b){var c;c=g.flags;for(var f=c=null!=c?c:(g.ignoreCase?"i":"")+(g.global?"g":"")+(g.multiline?"m":""),e=0;e<b.length;e++)-1==f.indexOf(b.charAt(e))&&(f+=b.charAt(e));return c==f?g:new RegExp(g.source,f)}function z(g,b,c){b=x(b,"g");var f=c.line,e=c.ch;for(c=g.lastLine();f<=
c;f++,e=0)if(b.lastIndex=e,e=g.getLine(f),e=b.exec(e))return{from:m(f,e.index),to:m(f,e.index+e[0].length),match:e}}function r(g,b,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(b.source))return z(g,b,c);b=x(b,"gm");for(var f,e=1,a=c.line,d=g.lastLine();a<=d;){for(var h=0;h<e&&!(a>d);h++){var t=g.getLine(a++);f=null==f?t:f+"\n"+t}e*=2;b.lastIndex=c.ch;if(h=b.exec(f))return b=f.slice(0,h.index).split("\n"),g=h[0].split("\n"),c=c.line+b.length-1,b=b[b.length-1].length,{from:m(c,b),to:m(c+g.length-1,1==g.length?
b+g[0].length:g[g.length-1].length),match:h}}}function n(g,b){for(var c,f=0;;){b.lastIndex=f;var e=b.exec(g);if(!e||(c=e,(f=c.index+(c[0].length||1))==g.length))return c}}function d(g,b,c){b=x(b,"g");var f=c.line,e=c.ch;for(c=g.firstLine();f>=c;f--,e=-1){var a=g.getLine(f);-1<e&&(a=a.slice(0,e));if(e=n(a,b))return{from:m(f,e.index),to:m(f,e.index+e[0].length),match:e}}}function l(g,b,c){b=x(b,"gm");for(var f,e=1,a=c.line,d=g.firstLine();a>=d;){for(var h=0;h<e;h++){var t=g.getLine(a--);f=null==f?t.slice(0,
c.ch):t+"\n"+f}e*=2;if(h=n(f,b))return b=f.slice(0,h.index).split("\n"),g=h[0].split("\n"),a+=b.length,b=b[b.length-1].length,{from:m(a,b),to:m(a+g.length-1,1==g.length?b+g[0].length:g[g.length-1].length),match:h}}}function k(g,b,c,f){if(g.length==b.length)return c;var a=0;for(b=c+Math.max(0,g.length-b.length);;){if(a==b)return a;var d=a+b>>1,m=f(g.slice(0,d)).length;if(m==c)return d;m>c?b=d:a=d+1}}function q(g,b,c,a){if(!b.length)return null;a=a?p:y;b=a(b).split(/\r|\n\r?/);var e=c.line;c=c.ch;var d=
g.lastLine()+1-b.length;a:for(;e<=d;e++,c=0){var l=g.getLine(e).slice(c),h=a(l);if(1==b.length){var t=h.indexOf(b[0]);if(-1==t)continue a;k(l,h,t,a);return{from:m(e,k(l,h,t,a)+c),to:m(e,k(l,h,t+b[0].length,a)+c)}}t=h.length-b[0].length;if(h.slice(t)==b[0]){for(var u=1;u<b.length-1;u++)if(a(g.getLine(e+u))!=b[u])continue a;var u=g.getLine(e+b.length-1),C=a(u),A=b[b.length-1];if(C.slice(0,A.length)==A)return{from:m(e,k(l,h,t,a)+c),to:m(e+b.length-1,k(u,C,A.length,a))}}}}function v(a,b,c,f){if(!b.length)return null;
f=f?p:y;b=f(b).split(/\r|\n\r?/);var e=c.line,d=c.ch,l=a.firstLine()-1+b.length;a:for(;e>=l;e--,d=-1){var h=a.getLine(e);-1<d&&(h=h.slice(0,d));d=f(h);if(1==b.length){c=d.lastIndexOf(b[0]);if(-1==c)continue a;return{from:m(e,k(h,d,c,f)),to:m(e,k(h,d,c+b[0].length,f))}}var t=b[b.length-1];if(d.slice(0,t.length)==t){var u=1;for(c=e-b.length+1;u<b.length-1;u++)if(f(a.getLine(c+u))!=b[u])continue a;c=a.getLine(e+1-b.length);u=f(c);if(u.slice(u.length-b[0].length)==b[0])return{from:m(e+1-b.length,k(c,
u,c.length-b[0].length,f)),to:m(e,k(h,d,t.length,f))}}}}function w(a,b,c,f){this.atOccurrence=!1;this.doc=a;c=c?a.clipPos(c):m(0,0);this.pos={from:c,to:c};var e;"object"==typeof f?e=f.caseFold:(e=f,f=null);"string"==typeof b?(null==e&&(e=!1),this.matches=function(c,d){return(c?v:q)(a,b,d,e)}):(b=x(b,"gm"),f&&!1===f.multiline?this.matches=function(c,e){return(c?d:z)(a,b,e)}:this.matches=function(c,d){return(c?l:r)(a,b,d)})}var p,y,m=a.Pos;String.prototype.normalize?(p=function(a){return a.normalize("NFD").toLowerCase()},
y=function(a){return a.normalize("NFD")}):(p=function(a){return a.toLowerCase()},y=function(a){return a});w.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(d){for(var b=this.matches(d,this.doc.clipPos(d?this.pos.from:this.pos.to));b&&0==a.cmpPos(b.from,b.to);)d?b.from.ch?b.from=m(b.from.line,b.from.ch-1):b=b.from.line==this.doc.firstLine()?null:this.matches(d,this.doc.clipPos(m(b.from.line-1))):b.to.ch<this.doc.getLine(b.to.line).length?
b.to=m(b.to.line,b.to.ch+1):b=b.to.line==this.doc.lastLine()?null:this.matches(d,m(b.to.line+1,0));if(b)return this.pos=b,this.atOccurrence=!0,this.pos.match||!0;d=m(d?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:d,to:d},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(d,b){if(this.atOccurrence){var c=a.splitLines(d);this.doc.replaceRange(c,this.pos.from,this.pos.to,b);this.pos.to=
m(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};a.defineExtension("getSearchCursor",function(a,b,c){return new w(this.doc,a,b,c)});a.defineDocExtension("getSearchCursor",function(a,b,c){return new w(this,a,b,c)});a.defineExtension("selectMatches",function(d,b){for(var c=[],f=this.getSearchCursor(d,this.getCursor("from"),b);f.findNext()&&!(0<a.cmpPos(f.to(),this.getCursor("to")));)c.push({anchor:f.from(),head:f.to()});c.length&&this.setSelections(c,0)})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/dialog/dialog",["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function x(a,n,d){var l;return l=a.getWrapperElement().appendChild(document.createElement("div")),l.className=d?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof n?l.innerHTML=n:l.appendChild(n),l}function z(a,n){a.state.currentNotificationClose&&
a.state.currentNotificationClose();a.state.currentNotificationClose=n}a.defineExtension("openDialog",function(r,n,d){function l(a){"string"==typeof a?p.value=a:v||(v=!0,q.parentNode.removeChild(q),w.focus(),d.onClose&&d.onClose(q))}d||(d={});z(this,null);var k,q=x(this,r,d.bottom),v=!1,w=this,p=q.getElementsByTagName("input")[0];return p?(p.focus(),d.value&&(p.value=d.value,!1!==d.selectValueOnOpen&&p.select()),d.onInput&&a.on(p,"input",function(a){d.onInput(a,p.value,l)}),d.onKeyUp&&a.on(p,"keyup",
function(a){d.onKeyUp(a,p.value,l)}),a.on(p,"keydown",function(k){d&&d.onKeyDown&&d.onKeyDown(k,p.value,l)||((27==k.keyCode||!1!==d.closeOnEnter&&13==k.keyCode)&&(p.blur(),a.e_stop(k),l()),13==k.keyCode&&n(p.value,k))}),!1!==d.closeOnBlur&&a.on(p,"blur",l)):(k=q.getElementsByTagName("button")[0])&&(a.on(k,"click",function(){l();w.focus()}),!1!==d.closeOnBlur&&a.on(k,"blur",l),k.focus()),l});a.defineExtension("openConfirm",function(r,n,d){function l(){q||(q=!0,k.parentNode.removeChild(k),v.focus())}
z(this,null);var k=x(this,r,d&&d.bottom);r=k.getElementsByTagName("button");var q=!1,v=this,w=1;r[0].focus();for(d=0;d<r.length;++d){var p=r[d];!function(d){a.on(p,"click",function(k){a.e_preventDefault(k);l();d&&d(v)})}(n[d]);a.on(p,"blur",function(){--w;setTimeout(function(){0>=w&&l()},200)});a.on(p,"focus",function(){++w})}});a.defineExtension("openNotification",function(r,n){function d(){q||(q=!0,clearTimeout(l),k.parentNode.removeChild(k))}z(this,d);var l,k=x(this,r,n&&n.bottom),q=!1,v=n&&void 0!==
n.duration?n.duration:5E3;return a.on(k,"click",function(k){a.e_preventDefault(k);d()}),v&&(l=setTimeout(d,v)),d})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("addon/search/search.js",["../../lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror)})(function(a){function x(h,a){return"string"==typeof h?h=new RegExp(h.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):h.global||(h=new RegExp(h.source,h.ignoreCase?"gi":"g")),{token:function(a){h.lastIndex=
a.pos;var b=h.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function z(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function r(h){return h.state.search||(h.state.search=new z)}function n(h){return"string"==typeof h&&h==h.toLowerCase()}function d(h,a,b){return h.getSearchCursor(a,b,{caseFold:n(a),multiline:!0})}function l(h,a,b,c,d){h.openDialog(a,c,{value:b,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){g(h)},
onKeyDown:d})}function k(h,a,b,c,d){h.openDialog?h.openDialog(a,d,{value:c,selectValueOnOpen:!0}):d(prompt(b,c))}function q(h,a,b,c){h.openConfirm?h.openConfirm(a,c):confirm(b)&&c[0]()}function v(a){return a.replace(/\\(.)/g,function(a,h){return"n"==h?"\n":"r"==h?"\r":h})}function w(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);if(b)try{a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(c){}else a=v(a);return("string"==typeof a?""==a:a.test(""))&&(a=/x^/),a}function p(a,b,c){b.queryText=c;b.query=w(c);
a.removeOverlay(b.overlay,n(b.query));b.overlay=x(b.query,n(b.query));a.addOverlay(b.overlay);a.showMatchesOnScrollbar&&(b.annotate&&(b.annotate.clear(),b.annotate=null),b.annotate=a.showMatchesOnScrollbar(b.query,n(b.query)))}function y(b,c,d,e){var g=r(b);if(g.query)return m(b,c);var n=b.getSelection()||g.lastQuery;if(n instanceof RegExp&&"x^"==n.source&&(n=null),d&&b.openDialog){var B=null,q=function(c,d){a.e_stop(d);c&&(c!=g.queryText&&(p(b,g,c),g.posFrom=g.posTo=b.getCursor()),B&&(B.style.opacity=
1),m(b,d.shiftKey,function(a,c){var d;3>c.line&&document.querySelector&&(d=b.display.wrapper.querySelector(".CodeMirror-dialog"))&&d.getBoundingClientRect().bottom-4>b.cursorCoords(c,"window").top&&((B=d).style.opacity=.4)}))};l(b,f,n,q,function(c,d){var e=a.keyName(c),g=b.getOption("extraKeys"),e=g&&g[e]||a.keyMap[b.getOption("keyMap")][e];"findNext"==e||"findPrev"==e||"findPersistentNext"==e||"findPersistentPrev"==e?(a.e_stop(c),p(b,r(b),d),b.execCommand(e)):"find"!=e&&"findPersistent"!=e||(a.e_stop(c),
q(d,c))});e&&n&&(p(b,g,n),m(b,c))}else k(b,f,"Search for:",n,function(a){a&&!g.query&&b.operation(function(){p(b,g,a);g.posFrom=g.posTo=b.getCursor();m(b,c)})})}function m(b,c,e){b.operation(function(){var g=r(b),f=d(b,g.query,c?g.posFrom:g.posTo);(f.find(c)||(f=d(b,g.query,c?a.Pos(b.lastLine()):a.Pos(b.firstLine(),0)),f.find(c)))&&(b.setSelection(f.from(),f.to()),b.scrollIntoView({from:f.from(),to:f.to()},20),g.posFrom=f.from(),g.posTo=f.to(),e&&e(f.from(),f.to()))})}function g(b){b.operation(function(){var a=
r(b);(a.lastQuery=a.query)&&(a.query=a.queryText=null,b.removeOverlay(a.overlay),a.annotate&&(a.annotate.clear(),a.annotate=null))})}function b(b,a,c){b.operation(function(){for(var e=d(b,a);e.findNext();)if("string"!=typeof a){var f=b.getRange(e.from(),e.to()).match(a);e.replace(c.replace(/\$(\d)/g,function(b,a){return f[a]}))}else e.replace(c)})}function c(a,c){if(!a.getOption("readOnly")){var f=a.getSelection()||r(a).lastQuery,l='\x3cspan class\x3d"CodeMirror-search-label"\x3e'+(c?"Replace all:":
"Replace:")+"\x3c/span\x3e";k(a,l+e,l,f,function(e){e&&(e=w(e),k(a,D,"Replace with:","",function(f){if(f=v(f),c)b(a,e,f);else{g(a);var k=d(a,e,a.getCursor("from")),l=function(){var c,g=k.from();!(c=k.findNext())&&(k=d(a,e),!(c=k.findNext())||g&&k.from().line==g.line&&k.from().ch==g.ch)||(a.setSelection(k.from(),k.to()),a.scrollIntoView({from:k.from(),to:k.to()}),q(a,E,"Replace?",[function(){m(c)},l,function(){b(a,e,f)}]))},m=function(a){k.replace("string"==typeof e?f:f.replace(/\$(\d)/g,function(b,
c){return a[c]}));l()};l()}}))})}}var f='\x3cspan class\x3d"CodeMirror-search-label"\x3eSearch:\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',e=' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',
D='\x3cspan class\x3d"CodeMirror-search-label"\x3eWith:\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',E='\x3cspan class\x3d"CodeMirror-search-label"\x3eReplace?\x3c/span\x3e \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eAll\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e';a.commands.find=function(a){g(a);y(a)};a.commands.findPersistent=function(a){g(a);y(a,!1,!0)};a.commands.findPersistentNext=function(a){y(a,
!1,!0,!0)};a.commands.findPersistentPrev=function(a){y(a,!0,!0,!0)};a.commands.findNext=y;a.commands.findPrev=function(a){y(a,!0)};a.commands.clearSearch=g;a.commands.replace=c;a.commands.replaceAll=function(a){c(a,!0)}});(function(a){"function"==typeof a.define&&a.define("addonSearch",["addon/search/search.js"],function(){})})(this);
