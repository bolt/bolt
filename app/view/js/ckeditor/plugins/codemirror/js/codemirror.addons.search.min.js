!function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/search/searchcursor",["../../lib/codemirror"],b):b(CodeMirror)}(function(b){function z(g,a){var c;c=g.flags;for(var f=c=null!=c?c:(g.ignoreCase?"i":"")+(g.global?"g":"")+(g.multiline?"m":""),e=0;e<a.length;e++)-1==f.indexOf(a.charAt(e))&&(f+=a.charAt(e));return c==f?g:new RegExp(g.source,f)}function B(g,a,c){a=z(a,"g");var f=c.line,e=c.ch;for(c=g.lastLine();f<=
c;f++,e=0)if(a.lastIndex=e,e=g.getLine(f),e=a.exec(e))return{from:l(f,e.index),to:l(f,e.index+e[0].length),match:e}}function p(g,a,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return B(g,a,c);a=z(a,"gm");for(var f,e=1,d=c.line,v=g.lastLine();d<=v;){for(var r=0;r<e&&!(d>v);r++){var b=g.getLine(d++);f=null==f?b:f+"\n"+b}e*=2;a.lastIndex=c.ch;if(r=a.exec(f))return a=f.slice(0,r.index).split("\n"),g=r[0].split("\n"),c=c.line+a.length-1,a=a[a.length-1].length,{from:l(c,a),to:l(c+g.length-1,1==g.length?
a+g[0].length:g[g.length-1].length),match:r}}}function n(g,a){for(var c,f=0;;){a.lastIndex=f;var e=a.exec(g);if(!e||(c=e,(f=c.index+(c[0].length||1))==g.length))return c}}function h(g,a,c){a=z(a,"g");var f=c.line,e=c.ch;for(c=g.firstLine();f>=c;f--,e=-1){var d=g.getLine(f);-1<e&&(d=d.slice(0,e));if(e=n(d,a))return{from:l(f,e.index),to:l(f,e.index+e[0].length),match:e}}}function q(g,a,c){a=z(a,"gm");for(var f,e=1,d=c.line,v=g.firstLine();d>=v;){for(var b=0;b<e;b++){var w=g.getLine(d--);f=null==f?w.slice(0,
c.ch):w+"\n"+f}e*=2;if(b=n(f,a))return a=f.slice(0,b.index).split("\n"),g=b[0].split("\n"),d+=a.length,a=a[a.length-1].length,{from:l(d,a),to:l(d+g.length-1,1==g.length?a+g[0].length:g[g.length-1].length),match:b}}}function k(g,a,c,f){if(g.length==a.length)return c;var b=0;for(a=c+Math.max(0,g.length-a.length);;){if(b==a)return b;var d=b+a>>1,v=f(g.slice(0,d)).length;if(v==c)return d;v>c?a=d:b=d+1}}function t(g,a,c,b){if(!a.length)return null;b=b?m:A;a=b(a).split(/\r|\n\r?/);var e=c.line;c=c.ch;var d=
g.lastLine()+1-a.length;a:for(;e<=d;e++,c=0){var v=g.getLine(e).slice(c),r=b(v);if(1==a.length){var w=r.indexOf(a[0]);if(-1==w)continue a;k(v,r,w,b);return{from:l(e,k(v,r,w,b)+c),to:l(e,k(v,r,w+a[0].length,b)+c)}}w=r.length-a[0].length;if(r.slice(w)==a[0]){for(var u=1;u<a.length-1;u++)if(b(g.getLine(e+u))!=a[u])continue a;var u=g.getLine(e+a.length-1),h=b(u),p=a[a.length-1];if(h.slice(0,p.length)==p)return{from:l(e,k(v,r,w,b)+c),to:l(e+a.length-1,k(u,h,p.length,b))}}}}function x(b,a,c,f){if(!a.length)return null;
f=f?m:A;a=f(a).split(/\r|\n\r?/);var e=c.line,d=c.ch,v=b.firstLine()-1+a.length;a:for(;e>=v;e--,d=-1){var r=b.getLine(e);-1<d&&(r=r.slice(0,d));d=f(r);if(1==a.length){c=d.lastIndexOf(a[0]);if(-1==c)continue a;return{from:l(e,k(r,d,c,f)),to:l(e,k(r,d,c+a[0].length,f))}}var w=a[a.length-1];if(d.slice(0,w.length)==w){var u=1;for(c=e-a.length+1;u<a.length-1;u++)if(f(b.getLine(c+u))!=a[u])continue a;c=b.getLine(e+1-a.length);u=f(c);if(u.slice(u.length-a[0].length)==a[0])return{from:l(e+1-a.length,k(c,
u,c.length-a[0].length,f)),to:l(e,k(r,d,w.length,f))}}}}function y(b,a,c,f){this.atOccurrence=!1;this.doc=b;c=c?b.clipPos(c):l(0,0);this.pos={from:c,to:c};var e;"object"==typeof f?e=f.caseFold:(e=f,f=null);"string"==typeof a?(null==e&&(e=!1),this.matches=function(d,c){return(d?x:t)(b,a,c,e)}):(a=z(a,"gm"),f&&!1===f.multiline?this.matches=function(d,c){return(d?h:B)(b,a,c)}:this.matches=function(d,c){return(d?q:p)(b,a,c)})}var m,A,l=b.Pos;String.prototype.normalize?(m=function(b){return b.normalize("NFD").toLowerCase()},
A=function(b){return b.normalize("NFD")}):(m=function(b){return b.toLowerCase()},A=function(b){return b});y.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(g){for(var a=this.matches(g,this.doc.clipPos(g?this.pos.from:this.pos.to));a&&0==b.cmpPos(a.from,a.to);)g?a.from.ch?a.from=l(a.from.line,a.from.ch-1):a=a.from.line==this.doc.firstLine()?null:this.matches(g,this.doc.clipPos(l(a.from.line-1))):a.to.ch<this.doc.getLine(a.to.line).length?
a.to=l(a.to.line,a.to.ch+1):a=a.to.line==this.doc.lastLine()?null:this.matches(g,l(a.to.line+1,0));if(a)return this.pos=a,this.atOccurrence=!0,this.pos.match||!0;g=l(g?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:g,to:g},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(g,a){if(this.atOccurrence){var c=b.splitLines(g);this.doc.replaceRange(c,this.pos.from,this.pos.to,a);this.pos.to=
l(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};b.defineExtension("getSearchCursor",function(b,a,c){return new y(this.doc,b,a,c)});b.defineDocExtension("getSearchCursor",function(b,a,c){return new y(this,b,a,c)});b.defineExtension("selectMatches",function(g,a){for(var c=[],f=this.getSearchCursor(g,this.getCursor("from"),a);f.findNext()&&!(0<b.cmpPos(f.to(),this.getCursor("to")));)c.push({anchor:f.from(),head:f.to()});c.length&&this.setSelections(c,0)})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/dialog/dialog",["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function z(p,n,h){var q;p=p.getWrapperElement();return q=p.appendChild(document.createElement("div")),q.className=h?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof n?q.innerHTML=n:q.appendChild(n),b.addClass(p,"dialog-opened"),
q}function B(b,n){b.state.currentNotificationClose&&b.state.currentNotificationClose();b.state.currentNotificationClose=n}b.defineExtension("openDialog",function(p,n,h){function q(k){"string"==typeof k?m.value=k:x||(x=!0,b.rmClass(t.parentNode,"dialog-opened"),t.parentNode.removeChild(t),y.focus(),h.onClose&&h.onClose(t))}h||(h={});B(this,null);var k,t=z(this,p,h.bottom),x=!1,y=this,m=t.getElementsByTagName("input")[0];return m?(m.focus(),h.value&&(m.value=h.value,!1!==h.selectValueOnOpen&&m.select()),
h.onInput&&b.on(m,"input",function(b){h.onInput(b,m.value,q)}),h.onKeyUp&&b.on(m,"keyup",function(b){h.onKeyUp(b,m.value,q)}),b.on(m,"keydown",function(k){h&&h.onKeyDown&&h.onKeyDown(k,m.value,q)||((27==k.keyCode||!1!==h.closeOnEnter&&13==k.keyCode)&&(m.blur(),b.e_stop(k),q()),13==k.keyCode&&n(m.value,k))}),!1!==h.closeOnBlur&&b.on(m,"blur",q)):(k=t.getElementsByTagName("button")[0])&&(b.on(k,"click",function(){q();y.focus()}),!1!==h.closeOnBlur&&b.on(k,"blur",q),k.focus()),q});b.defineExtension("openConfirm",
function(p,n,h){function q(){t||(t=!0,b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k),x.focus())}B(this,null);var k=z(this,p,h&&h.bottom);p=k.getElementsByTagName("button");var t=!1,x=this,y=1;p[0].focus();for(h=0;h<p.length;++h){var m=p[h];!function(h){b.on(m,"click",function(k){b.e_preventDefault(k);q();h&&h(x)})}(n[h]);b.on(m,"blur",function(){--y;setTimeout(function(){0>=y&&q()},200)});b.on(m,"focus",function(){++y})}});b.defineExtension("openNotification",function(p,n){function h(){t||
(t=!0,clearTimeout(q),b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k))}B(this,h);var q,k=z(this,p,n&&n.bottom),t=!1,x=n&&void 0!==n.duration?n.duration:5E3;return b.on(k,"click",function(k){b.e_preventDefault(k);h()}),x&&(q=setTimeout(h,x)),h})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("addon/search/search.js",["../../lib/codemirror","./searchcursor","../dialog/dialog"],b):b(CodeMirror)})(function(b){function z(d,a){return"string"==typeof d?d=new RegExp(d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):d.global||(d=new RegExp(d.source,d.ignoreCase?"gi":"g")),{token:function(a){d.lastIndex=
a.pos;var b=d.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function B(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function p(d){return d.state.search||(d.state.search=new B)}function n(d){return"string"==typeof d&&d==d.toLowerCase()}function h(d,a,b){return d.getSearchCursor(a,b,{caseFold:n(a),multiline:!0})}function q(d,a,b,c,e){d.openDialog(a,c,{value:b,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){g(d)},
onKeyDown:e})}function k(d,a,b,c,e){d.openDialog?d.openDialog(a,e,{value:c,selectValueOnOpen:!0}):e(prompt(b,c))}function t(d,a,b,c){d.openConfirm?d.openConfirm(a,c):confirm(b)&&c[0]()}function x(d){return d.replace(/\\(.)/g,function(d,a){return"n"==a?"\n":"r"==a?"\r":a})}function y(d){var a=d.match(/^\/(.*)\/([a-z]*)$/);if(a)try{d=new RegExp(a[1],-1==a[2].indexOf("i")?"":"i")}catch(b){}else d=x(d);return("string"==typeof d?""==d:d.test(""))&&(d=/x^/),d}function m(d,a,b){a.queryText=b;a.query=y(b);
d.removeOverlay(a.overlay,n(a.query));a.overlay=z(a.query,n(a.query));d.addOverlay(a.overlay);d.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),a.annotate=null),a.annotate=d.showMatchesOnScrollbar(a.query,n(a.query)))}function A(d,c,e,g){var f=p(d);if(f.query)return l(d,c);var h=d.getSelection()||f.lastQuery;if(h instanceof RegExp&&"x^"==h.source&&(h=null),e&&d.openDialog){var n=null,t=function(a,c){b.e_stop(c);a&&(a!=f.queryText&&(m(d,f,a),f.posFrom=f.posTo=d.getCursor()),n&&(n.style.opacity=
1),l(d,c.shiftKey,function(a,b){var c;3>b.line&&document.querySelector&&(c=d.display.wrapper.querySelector(".CodeMirror-dialog"))&&c.getBoundingClientRect().bottom-4>d.cursorCoords(b,"window").top&&((n=c).style.opacity=.4)}))};q(d,a(d),h,t,function(a,c){var f=b.keyName(a),e=d.getOption("extraKeys"),f=e&&e[f]||b.keyMap[d.getOption("keyMap")][f];"findNext"==f||"findPrev"==f||"findPersistentNext"==f||"findPersistentPrev"==f?(b.e_stop(a),m(d,p(d),c),d.execCommand(f)):"find"!=f&&"findPersistent"!=f||(b.e_stop(a),
t(c,a))});g&&h&&(m(d,f,h),l(d,c))}else k(d,a(d),"Search for:",h,function(a){a&&!f.query&&d.operation(function(){m(d,f,a);f.posFrom=f.posTo=d.getCursor();l(d,c)})})}function l(a,c,f){a.operation(function(){var e=p(a),g=h(a,e.query,c?e.posFrom:e.posTo);(g.find(c)||(g=h(a,e.query,c?b.Pos(a.lastLine()):b.Pos(a.firstLine(),0)),g.find(c)))&&(a.setSelection(g.from(),g.to()),a.scrollIntoView({from:g.from(),to:g.to()},20),e.posFrom=g.from(),e.posTo=g.to(),f&&f(g.from(),g.to()))})}function g(a){a.operation(function(){var b=
p(a);(b.lastQuery=b.query)&&(b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function a(a){return'\x3cspan class\x3d"CodeMirror-search-label"\x3e'+a.phrase("Search:")+'\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e'+a.phrase("(Use /re/ syntax for regexp search)")+"\x3c/span\x3e"}function c(a){return'\x3cspan class\x3d"CodeMirror-search-label"\x3e'+
a.phrase("Replace?")+"\x3c/span\x3e \x3cbutton\x3e"+a.phrase("Yes")+"\x3c/button\x3e \x3cbutton\x3e"+a.phrase("No")+"\x3c/button\x3e \x3cbutton\x3e"+a.phrase("All")+"\x3c/button\x3e \x3cbutton\x3e"+a.phrase("Stop")+"\x3c/button\x3e "}function f(a,b,c){a.operation(function(){for(var f=h(a,b);f.findNext();)if("string"!=typeof b){var e=a.getRange(f.from(),f.to()).match(b);f.replace(c.replace(/\$(\d)/g,function(a,b){return e[b]}))}else f.replace(c)})}function e(a,b){if(!a.getOption("readOnly")){var e=
a.getSelection()||p(a).lastQuery,l='\x3cspan class\x3d"CodeMirror-search-label"\x3e'+(b?a.phrase("Replace all:"):a.phrase("Replace:"))+"\x3c/span\x3e";k(a,l+(' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e'+a.phrase("(Use /re/ syntax for regexp search)")+"\x3c/span\x3e"),l,e,function(e){e&&(e=y(e),k(a,'\x3cspan class\x3d"CodeMirror-search-label"\x3e'+a.phrase("With:")+'\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',
a.phrase("Replace with:"),"",function(k){if(k=x(k),b)f(a,e,k);else{g(a);var l=h(a,e,a.getCursor("from")),m=function(){var b,g=l.from();!(b=l.findNext())&&(l=h(a,e),!(b=l.findNext())||g&&l.from().line==g.line&&l.from().ch==g.ch)||(a.setSelection(l.from(),l.to()),a.scrollIntoView({from:l.from(),to:l.to()}),t(a,c(a),a.phrase("Replace?"),[function(){n(b)},m,function(){f(a,e,k)}]))},n=function(a){l.replace("string"==typeof e?k:k.replace(/\$(\d)/g,function(b,d){return a[d]}));m()};m()}}))})}}b.commands.find=
function(a){g(a);A(a)};b.commands.findPersistent=function(a){g(a);A(a,!1,!0)};b.commands.findPersistentNext=function(a){A(a,!1,!0,!0)};b.commands.findPersistentPrev=function(a){A(a,!0,!0,!0)};b.commands.findNext=A;b.commands.findPrev=function(a){A(a,!0)};b.commands.clearSearch=g;b.commands.replace=e;b.commands.replaceAll=function(a){e(a,!0)}});(function(b){"function"==typeof b.define&&b.define("addonSearch",["addon/search/search.js"],function(){})})(this);
