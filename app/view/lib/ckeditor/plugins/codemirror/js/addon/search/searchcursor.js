(function(){function m(e,a,f,c){this.atOccurrence=!1;this.cm=e;null==c&&"string"==typeof a&&(c=!1);f=f?e.clipPos(f):i(0,0);this.pos={from:f,to:f};if("string"!=typeof a)a.global||(a=RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(n,h){if(n){a.lastIndex=0;for(var g=e.getLine(h.line).slice(0,h.ch),d=a.exec(g),b=0;d;){b+=d.index+1;g=g.slice(b);a.lastIndex=0;var c=a.exec(g);if(c)d=c;else break}b--}else a.lastIndex=h.ch,g=e.getLine(h.line),b=(d=a.exec(g))&&d.index;if(d&&d[0])return{from:i(h.line,
b),to:i(h.line,b+d[0].length),match:d}};else{c&&(a=a.toLowerCase());var j=c?function(a){return a.toLowerCase()}:function(a){return a},k=a.split("\n");this.matches=1==k.length?a.length?function(c,h){var g=j(e.getLine(h.line)),d=a.length,b;if(c?h.ch>=d&&-1!=(b=g.lastIndexOf(a,h.ch-d)):-1!=(b=g.indexOf(a,h.ch)))return{from:i(h.line,b),to:i(h.line,b+d)}}:function(){}:function(a,c){var g=c.line,d=a?k.length-1:0,b=k[d],f=j(e.getLine(g)),l=a?f.indexOf(b)+b.length:f.lastIndexOf(b);if(!(a?l>=c.ch||l!=b.length:
l<=c.ch||l!=f.length-b.length))for(;!(a?!g:g==e.lineCount()-1);){f=j(e.getLine(g+=a?-1:1));b=k[a?--d:++d];if(0<d&&d<k.length-1)if(f!=b)break;else continue;d=a?f.lastIndexOf(b):f.indexOf(b)+b.length;if(a?d!=f.length-b.length:d!=b.length)break;b=i(c.line,l);g=i(g,d);return{from:a?g:b,to:a?b:g}}}}}var i=CodeMirror.Pos;m.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function a(a){a=i(a,0);f.pos={from:a,to:a};return f.atOccurrence=!1}
for(var f=this,c=this.cm.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,c))return(!this.pos.from||!this.pos.to)&&console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!c.line)return a(0);c=i(c.line-1,this.cm.getLine(c.line-1).length)}else{var j=this.cm.lineCount();if(c.line==j-1)return a(j);c=i(c.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){this.atOccurrence&&
(e=CodeMirror.splitLines(e),this.cm.replaceRange(e,this.pos.from,this.pos.to),this.pos.to=i(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0)))}};CodeMirror.defineExtension("getSearchCursor",function(e,a,f){return new m(this,e,a,f)})})();