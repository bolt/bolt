(function(){function m(d,a,e,c){this.atOccurrence=!1;this.cm=d;null==c&&"string"==typeof a&&(c=!1);e=e?d.clipPos(e):i(0,0);this.pos={from:e,to:e};if("string"!=typeof a)a.global||(a=RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(n,h){if(n){a.lastIndex=0;for(var g=d.getLine(h.line).slice(0,h.ch),f=0,b,c;;){a.lastIndex=f;f=a.exec(g);if(!f)break;b=f;c=b.index;f=b.index+1}}else a.lastIndex=h.ch,g=d.getLine(h.line),c=(b=a.exec(g))&&b.index;if(b&&b[0])return{from:i(h.line,c),to:i(h.line,c+
b[0].length),match:b}};else{c&&(a=a.toLowerCase());var j=c?function(a){return a.toLowerCase()}:function(a){return a},k=a.split("\n");this.matches=1==k.length?a.length?function(c,h){var g=j(d.getLine(h.line)),f=a.length,b;if(c?h.ch>=f&&-1!=(b=g.lastIndexOf(a,h.ch-f)):-1!=(b=g.indexOf(a,h.ch)))return{from:i(h.line,b),to:i(h.line,b+f)}}:function(){}:function(a,c){var g=c.line,f=a?k.length-1:0,b=k[f],e=j(d.getLine(g)),l=a?e.indexOf(b)+b.length:e.lastIndexOf(b);if(!(a?l>=c.ch||l!=b.length:l<=c.ch||l!=
e.length-b.length))for(;!(a?!g:g==d.lineCount()-1);){e=j(d.getLine(g+=a?-1:1));b=k[a?--f:++f];if(0<f&&f<k.length-1)if(e!=b)break;else continue;f=a?e.lastIndexOf(b):e.indexOf(b)+b.length;if(a?f!=e.length-b.length:f!=b.length)break;b=i(c.line,l);g=i(g,f);return{from:a?g:b,to:a?b:g}}}}}var i=CodeMirror.Pos;m.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(d){function a(a){a=i(a,0);e.pos={from:a,to:a};return e.atOccurrence=!1}for(var e=
this,c=this.cm.clipPos(d?this.pos.from:this.pos.to);;){if(this.pos=this.matches(d,c))return(!this.pos.from||!this.pos.to)&&console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(d){if(!c.line)return a(0);c=i(c.line-1,this.cm.getLine(c.line-1).length)}else{var j=this.cm.lineCount();if(c.line==j-1)return a(j);c=i(c.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(d){this.atOccurrence&&
(d=CodeMirror.splitLines(d),this.cm.replaceRange(d,this.pos.from,this.pos.to),this.pos.to=i(this.pos.from.line+d.length-1,d[d.length-1].length+(1==d.length?this.pos.from.ch:0)))}};CodeMirror.defineExtension("getSearchCursor",function(d,a,e){return new m(this,d,a,e)})})();